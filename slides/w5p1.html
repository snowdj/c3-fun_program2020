<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Parellel Iterations</title>
    <meta charset="utf-8" />
    <meta name="author" content="Daniel Anderson" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Parellel Iterations
## And a few additional {purrr} functions
### Daniel Anderson
### Week 5, Class 1

---




# Agenda
* Finish up slides from Wednesday

* Discuss `map2_*` and `pmap_*`

* Introduce `walk`, `modify` and `safely`


--
### Note
* I am expecting we will again not get through all of this. 
* I want to take the time we need with list columns .b[and] the content for today
* We have a built in "fudge" day this week - we'll officially get caught up then.

---
# Learning objectives
* Understand the differences between `map`, `map2`, and `pmap`

* Know when to apply `walk` instead of `map`, and why it may be useful

* Understand the parallels and differences between `map` and `modify`

* Diagnose errors with `safely` (and understand other situations where it may
be helpful)

---
class: inverse
background-image:url(https://d33wubrfki0l68.cloudfront.net/7a545699ff7069a98329fcfbe6e42b734507eb16/211a5/diagrams/functionals/map2-arg.png)
background-size:contain
# `map2`

---
class: inverse center middle

# A few Examples
Basic simulations - iterating over two vectors

Plots by month, changing the title

---
# Simulation
* Simulate data from a normal distribution
	+ Vary `\(n\)` from 5 to 150 by increments of 5
	+ For each `\(n\)`, vary `\(mu\)` from -2 to 2 by increments of 0.25


--
### How do we get all combinations

--
`expand.grid`

---
# Example `expand.grid`
### Bonus: It turns it into a data frame!

```r
ints &lt;- 1:3
lets &lt;- c("a", "b", "c")
expand.grid(ints, lets)
```

```
##   Var1 Var2
## 1    1    a
## 2    2    a
## 3    3    a
## 4    1    b
## 5    2    b
## 6    3    b
## 7    1    c
## 8    2    c
## 9    3    c
```

---
# Set conditions


```r
conditions &lt;- expand.grid(n = seq(5, 150, 5),
                          mu = seq(-2, 2, 0.25))
head(conditions)
```

```
##    n mu
## 1  5 -2
## 2 10 -2
## 3 15 -2
## 4 20 -2
## 5 25 -2
## 6 30 -2
```

```r
tail(conditions)
```

```
##       n mu
## 505 125  2
## 506 130  2
## 507 135  2
## 508 140  2
## 509 145  2
## 510 150  2
```

---
# Simulate!


```r
sim1 &lt;- map2(conditions$n, conditions$mu, ~rnorm(n = .x, mean = .y, sd = 10))
str(sim1)
```

```
## List of 510
##  $ : num [1:5] 0.2 -7.57 -1.34 9.97 6.58
##  $ : num [1:10] -18.64 15.26 -2.94 -12.33 -4.83 ...
##  $ : num [1:15] -7.72 -13.27 -2.14 3.85 -5.1 ...
##  $ : num [1:20] 22.49 3.13 7.93 -14.81 -2.74 ...
##  $ : num [1:25] 4.2 13.3 6.51 14.54 -6.42 ...
##  $ : num [1:30] 8.05 -11.47 2.17 -1.35 -9.08 ...
##  $ : num [1:35] -3.428 -16.231 -15.253 -6.926 -0.141 ...
##  $ : num [1:40] 5.01 10.71 -9.77 -1.28 -2.13 ...
##  $ : num [1:45] -8.18 -14.39 -13.35 -8.22 -9.06 ...
##  $ : num [1:50] -10.1 -9.76 4.67 4.94 -9.37 ...
##  $ : num [1:55] 6.65 6.33 11.93 -2.2 2.27 ...
##  $ : num [1:60] -2.77 -14.01 12.78 -2.87 -7.73 ...
##  $ : num [1:65] -7.02 -12.57 -13.35 7.54 21.94 ...
##  $ : num [1:70] -9.101 5.2 0.848 6.681 -3.783 ...
##  $ : num [1:75] -5.2 8.93 -9.05 9.36 -1.25 ...
##  $ : num [1:80] 25.338 -0.533 -8.523 6.615 18.895 ...
##  $ : num [1:85] 10.3 -5.92 -16.58 1.24 10.62 ...
##  $ : num [1:90] -10.08 -5.96 2.52 -3.77 10.34 ...
##  $ : num [1:95] 0.309 -15.444 0.666 5.216 -12.174 ...
##  $ : num [1:100] 4.3 1.77 -7.61 -11.7 -8.18 ...
##  $ : num [1:105] -6.871 -0.776 6.701 12 -1.849 ...
##  $ : num [1:110] 8.76 24.22 -10.68 -13.71 -14.09 ...
##  $ : num [1:115] 0.663 0.319 2.859 -9.647 -5.224 ...
##  $ : num [1:120] 10.393 -6.136 -0.144 -3.243 13.772 ...
##  $ : num [1:125] 3.708 0.581 -14.861 -15.249 -14.083 ...
##  $ : num [1:130] 14.154 -0.301 2.019 -4.357 -0.319 ...
##  $ : num [1:135] -1.56 -10.469 -9.281 1.835 -0.308 ...
##  $ : num [1:140] 9.283 -2.902 -0.517 -8.894 -8.299 ...
##  $ : num [1:145] 7.3 -16.44 5.83 -21.49 4.77 ...
##  $ : num [1:150] -9.92 1.02 7.91 9.73 -1.85 ...
##  $ : num [1:5] 0.764 1.481 -4.618 0.494 -6.14
##  $ : num [1:10] -4.708 -13.41 11.383 0.753 17.462 ...
##  $ : num [1:15] -15.95 15.67 -4.83 -6.23 8.52 ...
##  $ : num [1:20] 10.88 -5.71 -13.53 8.67 -16.25 ...
##  $ : num [1:25] -12.79 14.61 -26.96 6.06 2.3 ...
##  $ : num [1:30] -5.88 -3.99 -3.49 23.69 -13.18 ...
##  $ : num [1:35] -11.96 6.28 -3.47 -7.85 7.34 ...
##  $ : num [1:40] -3.578 25.963 0.453 -0.906 -16.416 ...
##  $ : num [1:45] -6.47 11.59 14.21 -20 -1.54 ...
##  $ : num [1:50] 0.0888 -11.521 6.7569 4.541 -5.2555 ...
##  $ : num [1:55] 2.72 -5.76 5.8 -10.79 -1.13 ...
##  $ : num [1:60] 2.73 2.24 -6.33 7.91 -1.97 ...
##  $ : num [1:65] -15.99 3.342 -4.657 -0.873 8.824 ...
##  $ : num [1:70] 28.3 -11.16 -15.72 4.69 -19.91 ...
##  $ : num [1:75] 0.979 10.06 -2.646 -13.421 -5.568 ...
##  $ : num [1:80] -16.8 -0.72 19.45 -12.96 -5.35 ...
##  $ : num [1:85] 2.2663 -0.0488 -20.8054 1.584 3.7334 ...
##  $ : num [1:90] 2.08 -10.06 6.22 -14.21 -2.52 ...
##  $ : num [1:95] -0.854 2.121 24.794 8.168 7.891 ...
##  $ : num [1:100] -5.2 -8.03 -1.18 5.05 11.82 ...
##  $ : num [1:105] 8.32 -3.65 -7.1 -11 -11.29 ...
##  $ : num [1:110] 2.198 7.909 2.637 -4.754 -0.263 ...
##  $ : num [1:115] 0.135 3.759 -6.049 -9.448 -1.012 ...
##  $ : num [1:120] 0.514 -16.875 7.022 -20.362 -6.764 ...
##  $ : num [1:125] -22.56 2.01 -3.02 -6.21 -13.9 ...
##  $ : num [1:130] 4.815 -11.157 7.089 -0.988 16.48 ...
##  $ : num [1:135] 14.81 4.92 -11.79 -8.51 -12.97 ...
##  $ : num [1:140] 12.69 16.71 -7.12 -20.46 -7.45 ...
##  $ : num [1:145] 10.79 -6.04 -16.34 -2.04 10.33 ...
##  $ : num [1:150] -13.836 -0.274 7.962 1.266 -11.574 ...
##  $ : num [1:5] -4.94 -4.8 -1.1 7.47 8.98
##  $ : num [1:10] -5.35 -17.45 3.75 -6.69 -5.11 ...
##  $ : num [1:15] -10.5 6.75 4.44 0.52 -8.31 ...
##  $ : num [1:20] -3.69 7.94 17.71 5.12 17.69 ...
##  $ : num [1:25] 2.2 2.24 -9.88 5.5 9.9 ...
##  $ : num [1:30] -1.16 -3.5 13.34 -15.38 4.64 ...
##  $ : num [1:35] 8.41 6.48 -8.12 -10.38 13.99 ...
##  $ : num [1:40] 1.68 10.23 -1.83 6.2 -8.19 ...
##  $ : num [1:45] -14.413 -0.359 -21.334 3.679 -13.377 ...
##  $ : num [1:50] -10.735 6.128 -0.344 -3.524 -5.087 ...
##  $ : num [1:55] 23.01 -5.16 -7.6 1.55 16.34 ...
##  $ : num [1:60] -5.259 3.153 -8.196 0.668 5.192 ...
##  $ : num [1:65] -0.67 12.19 8.1 -17.06 7.11 ...
##  $ : num [1:70] 7.72 1.96 9.74 10.75 3.12 ...
##  $ : num [1:75] -23.93 1.89 -3.29 -7.01 -3.13 ...
##  $ : num [1:80] 2.39 -2.24 6.41 -6.63 1.56 ...
##  $ : num [1:85] -0.713 -6.884 -2.179 17.289 14.645 ...
##  $ : num [1:90] -20.806 9.545 0.315 4.357 -2.16 ...
##  $ : num [1:95] 14.9305 -3.5579 1.6878 5.3908 -0.0421 ...
##  $ : num [1:100] -5.407 -10.739 1.81 0.795 4.573 ...
##  $ : num [1:105] 8.05 -14.23 -7.68 -3.31 -8.7 ...
##  $ : num [1:110] 0.691 -14.533 2.287 -1.815 -7.319 ...
##  $ : num [1:115] -19.46 -5.01 12.07 9.33 -6.7 ...
##  $ : num [1:120] 9.79 -14.96 4.91 12.58 -9.02 ...
##  $ : num [1:125] -3.41 25.92 10.96 1.47 -9.26 ...
##  $ : num [1:130] -15.14 7.4 -15.44 8.32 -4.05 ...
##  $ : num [1:135] -1.69 6.8 -10.98 -11.54 5.27 ...
##  $ : num [1:140] -19.23 14.69 8.35 6.91 8.41 ...
##  $ : num [1:145] 17.64 11.17 4.25 -3.79 -5.58 ...
##  $ : num [1:150] -21.68 6.63 -26.6 -6.18 -11.46 ...
##  $ : num [1:5] 4.52 6.06 -15.78 -5.4 17.31
##  $ : num [1:10] -8.81 4.99 -4.39 3.03 11.24 ...
##  $ : num [1:15] -0.821 -15.156 -5.815 7.588 -6.258 ...
##  $ : num [1:20] -1.653 -9.561 -5.408 0.478 -5.23 ...
##  $ : num [1:25] -3.47 4.83 -6.36 3.33 -3.84 ...
##  $ : num [1:30] 4.61 -9.47 5.46 7.28 -3.47 ...
##  $ : num [1:35] -16.3 -12.126 0.691 12.252 19.282 ...
##  $ : num [1:40] 15.05 2.76 -11.89 -3.04 2.31 ...
##  $ : num [1:45] -14.18 -2.02 -7.53 6.34 -12.81 ...
##   [list output truncated]
```

---
# More powerful
### Add it as a list column!


```r
sim2 &lt;- conditions %&gt;%
	as_tibble() %&gt;% # Not required, but definitely helpful
	mutate(sim = map2(n, mu, ~rnorm(n = .x, mean = .y, sd = 10))) 
sim2
```

```
## # A tibble: 510 x 3
##        n    mu sim       
##    &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1     5    -2 &lt;dbl [5]&gt; 
##  2    10    -2 &lt;dbl [10]&gt;
##  3    15    -2 &lt;dbl [15]&gt;
##  4    20    -2 &lt;dbl [20]&gt;
##  5    25    -2 &lt;dbl [25]&gt;
##  6    30    -2 &lt;dbl [30]&gt;
##  7    35    -2 &lt;dbl [35]&gt;
##  8    40    -2 &lt;dbl [40]&gt;
##  9    45    -2 &lt;dbl [45]&gt;
## 10    50    -2 &lt;dbl [50]&gt;
## # … with 500 more rows
```

---
# Unnest


```r
conditions %&gt;%
	as_tibble() %&gt;% # Not required, but definitely helpful
	mutate(sim = map2(n, mu, ~rnorm(.x, .y, sd = 10))) %&gt;%
	unnest()
```

```
## # A tibble: 39,525 x 3
##        n    mu         sim
##    &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
##  1     5    -2  -5.718192 
##  2     5    -2  18.72070  
##  3     5    -2 -11.49876  
##  4     5    -2 -27.22668  
##  5     5    -2   0.6224170
##  6    10    -2  -1.099634 
##  7    10    -2 -12.89692  
##  8    10    -2   8.472918 
##  9    10    -2  -2.644447 
## 10    10    -2 -21.10733  
## # … with 39,515 more rows
```

---
class: inverse center middle
# What if we wanted to vary the sd too?

--
### `pmap`
Which we'll get to soon

---
# Varying the title of a plot
### The data

```r
library(fivethirtyeight)
pulitzer
```

```
## # A tibble: 50 x 7
##    newspaper circ2004 circ2013 pctchg_circ num_finals1990_2003
##    &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;               &lt;int&gt;
##  1 USA Today  2192098  1674306         -24                   1
##  2 Wall Str…  2101017  2378827          13                  30
##  3 New York…  1119027  1865318          67                  55
##  4 Los Ange…   983727   653868         -34                  44
##  5 Washingt…   760034   474767         -38                  52
##  6 New York…   712671   516165         -28                   4
##  7 New York…   642844   500521         -22                   0
##  8 Chicago …   603315   414930         -31                  23
##  9 San Jose…   558874   583998           4                   4
## 10 Newsday     553117   377744         -32                  12
## # … with 40 more rows, and 2 more variables: num_finals2004_2014 &lt;int&gt;,
## #   num_finals1990_2014 &lt;int&gt;
```

---
# Prep data


```r
pulitzer &lt;- pulitzer %&gt;%
  select(newspaper, starts_with("num")) %&gt;%
  pivot_longer(-newspaper,
               names_to = "year_range", 
               values_to = "n",
               names_prefix = "num_finals") %&gt;% 
  mutate(year_range = str_replace_all(year_range, "_", "-")) %&gt;%
  filter(year_range != "1990-2014")

head(pulitzer)
```

```
## # A tibble: 6 x 3
##   newspaper           year_range     n
##   &lt;chr&gt;               &lt;chr&gt;      &lt;int&gt;
## 1 USA Today           1990-2003      1
## 2 USA Today           2004-2014      1
## 3 Wall Street Journal 1990-2003     30
## 4 Wall Street Journal 2004-2014     20
## 5 New York Times      1990-2003     55
## 6 New York Times      2004-2014     62
```

---
# One plot


```r
pulitzer %&gt;%
	filter(newspaper == "Wall Street Journal") %&gt;%
ggplot(aes(year_range, n)) +
	geom_col(aes(fill = n)) +
	scale_fill_distiller(type = "seq", 
	                     limits = c(0, max(pulitzer$n)),
	                     palette = "BuPu",
	                     direction = 1) +
	ylim(0, max(pulitzer$n)) +
	coord_flip() +
	labs(title = "Pulitzer Prize winners: Wall Street Journal",
	     x = "Year Range") 
```

![](w5p1_files/figure-html/one-plot-pulitzer-1.png)&lt;!-- --&gt;


---
# Nest data


```r
pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest()
```

```
## # A tibble: 50 x 2
## # Groups:   newspaper [50]
##    newspaper             data            
##    &lt;chr&gt;                 &lt;list&gt;          
##  1 USA Today             &lt;tibble [2 × 2]&gt;
##  2 Wall Street Journal   &lt;tibble [2 × 2]&gt;
##  3 New York Times        &lt;tibble [2 × 2]&gt;
##  4 Los Angeles Times     &lt;tibble [2 × 2]&gt;
##  5 Washington Post       &lt;tibble [2 × 2]&gt;
##  6 New York Daily News   &lt;tibble [2 × 2]&gt;
##  7 New York Post         &lt;tibble [2 × 2]&gt;
##  8 Chicago Tribune       &lt;tibble [2 × 2]&gt;
##  9 San Jose Mercury News &lt;tibble [2 × 2]&gt;
## 10 Newsday               &lt;tibble [2 × 2]&gt;
## # … with 40 more rows
```


---
# Produce all plots
### You try first!
Don't worry about the correct title yet, if you don't want

--


```r
pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest() %&gt;%
	mutate(plot = map(data, ~
      ggplot(.x, aes(year_range, n)) +
        geom_col(aes(fill = n)) +
        scale_fill_distiller(type = "seq", 
                             limits = c(0, max(pulitzer$n)),
                             palette = "BuPu",
                             direction = 1) +
        ylim(0, max(pulitzer$n)) +
        coord_flip() +
        labs(title = "Pulitzer Prize winners")
    )
  )
```

---
# Add title


```r
library(glue)

p &lt;- pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	nest() %&gt;%
*   mutate(plot = map2(data, newspaper, ~
    ggplot(.x, aes(year_range, n)) +
      geom_col(aes(fill = n)) +
      scale_fill_distiller(type = "seq", 
                           limits = c(0, max(pulitzer$n)),
                           palette = "BuPu",
                           direction = 1) +
      ylim(0, max(pulitzer$n)) +
      coord_flip() +
*     labs(title = glue("Pulitzer Prize winners: {.y}"))
    )
  )
```

---

```r
p
```

```
## # A tibble: 50 x 3
## # Groups:   newspaper [50]
##    newspaper             data             plot  
##    &lt;chr&gt;                 &lt;list&gt;           &lt;list&gt;
##  1 USA Today             &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  2 Wall Street Journal   &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  3 New York Times        &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  4 Los Angeles Times     &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  5 Washington Post       &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  6 New York Daily News   &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  7 New York Post         &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  8 Chicago Tribune       &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
##  9 San Jose Mercury News &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
## 10 Newsday               &lt;tibble [2 × 2]&gt; &lt;gg&gt;  
## # … with 40 more rows
```

---
# Look at a couple plots

.pull-left[

```r
p$plot[[1]]
```

![](w5p1_files/figure-html/p1-1.png)&lt;!-- --&gt;

```r
p$plot[[3]]
```

![](w5p1_files/figure-html/p1-2.png)&lt;!-- --&gt;
]

.pull-right[

```r
p$plot[[2]]
```

![](w5p1_files/figure-html/p2-1.png)&lt;!-- --&gt;

```r
p$plot[[4]]
```

![](w5p1_files/figure-html/p2-2.png)&lt;!-- --&gt;
]

---
class: inverse center middle
# iterating over `\(n\)` vectors
### `pmap`


---
class: inverse
background-image:url(https://d33wubrfki0l68.cloudfront.net/e426c5755e2e65bdcc073d387775db79791f32fd/92902/diagrams/functionals/pmap.png)
background-size:contain
## `pmap`


---
# Simulation
* Simulate data from a normal distribution
	+ Vary `\(n\)` from 5 to 150 by increments of 5
	+ For each `\(n\)`, vary `\(mu\)` from -2 to 2 by increments of 0.25
	+ For each `\(\sigma\)` from 1 to 3 by increments of 0.1


---

```r
full_conditions &lt;- expand.grid(n = seq(5, 150, 5),
                               mu = seq(-2, 2, 0.25),
                               sd = seq(1, 3, .1))
head(full_conditions)
```

```
##    n mu sd
## 1  5 -2  1
## 2 10 -2  1
## 3 15 -2  1
## 4 20 -2  1
## 5 25 -2  1
## 6 30 -2  1
```

```r
tail(full_conditions)
```

```
##         n mu sd
## 10705 125  2  3
## 10706 130  2  3
## 10707 135  2  3
## 10708 140  2  3
## 10709 145  2  3
## 10710 150  2  3
```

---
# Full Simulation


```r
fsim &lt;- pmap(list(number = full_conditions$n,
                  average = full_conditions$mu,
                  stdev = full_conditions$sd), 
             function(number, average, stdev) {
             	rnorm(n = number, mean = average, sd = stdev)
             })
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -0.964 -1.903 -1.831 -4.485 -1.906
##  $ : num [1:10] -1.71 -2.95 -3.04 -1.82 -2.78 ...
##  $ : num [1:15] -2.774 -2.665 -1.386 -0.116 -3.232 ...
##  $ : num [1:20] -0.466 -2.779 -0.905 -0.567 -1.097 ...
##  $ : num [1:25] -4.46 -1.19 -2.51 -1.12 -2.46 ...
##  $ : num [1:30] -2.05 -2.82 -1.36 -1.22 -2.42 ...
##  $ : num [1:35] -2.1 -1.22 -3.91 -1.16 -2.45 ...
##  $ : num [1:40] -1.844 -2.21 -2.75 -3.205 -0.812 ...
##  $ : num [1:45] -2.328 -2.959 -0.604 -1.146 -2.36 ...
##  $ : num [1:50] -3.2 -3.53 -2.62 -3.02 -3.75 ...
##  $ : num [1:55] -1.45 -1.24 -2.77 -3.36 -2.56 ...
##  $ : num [1:60] -0.339 -3.022 -2.115 -2.686 -2.059 ...
##  $ : num [1:65] -1.16 -3.26 -3.89 -2.94 -1.97 ...
##  $ : num [1:70] -3.31 -2.82 -2.51 -1.36 -2.17 ...
##  $ : num [1:75] -3.21 -2.05 -1.11 -2.63 -2.18 ...
##  $ : num [1:80] -2.74 -2.45 -1.74 -4.24 -2.27 ...
##  $ : num [1:85] -2.05 -1.34 -1.92 -3.64 -2.95 ...
##  $ : num [1:90] -1.71 -3.35 -1.69 -2.76 -1.66 ...
##  $ : num [1:95] -2.45 -2.23 -2.44 -1.5 -2.24 ...
##  $ : num [1:100] -3.944 -0.144 -2.487 -3.245 -0.818 ...
##  $ : num [1:105] -2.894 -2.296 -1.747 -5.086 -0.622 ...
##  $ : num [1:110] -0.384 -2.613 -2.414 -2.735 -2.183 ...
##  $ : num [1:115] -1.89 -5.01 -1.19 -2.72 -1.23 ...
##  $ : num [1:120] -2.872 -1.514 -0.773 -2.558 -1.767 ...
##  $ : num [1:125] -1.074 -0.869 -1.427 -2.581 -3.292 ...
##  $ : num [1:130] 0.121 -2.495 -1.974 -0.553 -1.628 ...
##  $ : num [1:135] 0.0271 -3.2186 -1.2769 -3.0401 -2.3733 ...
##  $ : num [1:140] -3.03 -2.67 -1.01 -1.17 -2.07 ...
##  $ : num [1:145] 0.129 -3.004 -3.655 -0.66 -2.267 ...
##  $ : num [1:150] -2.017 -2.333 -0.879 -2.982 -1.416 ...
##  $ : num [1:5] 0.784 -1.106 -1.161 -1.156 -4.032
##  $ : num [1:10] -0.137 -0.773 -2.108 -2.95 -1.839 ...
##  $ : num [1:15] -0.293 -1.289 -2.877 -2.584 -1.361 ...
##  $ : num [1:20] -3.026 -1.7 -0.876 -2.669 -0.991 ...
##  $ : num [1:25] -1.89 -0.564 -2.994 -1.033 -2.428 ...
##  $ : num [1:30] -1.029 -0.619 -2.715 -1.8 -2.631 ...
##  $ : num [1:35] -2.38 -2.72 -2.74 -1.73 -2.05 ...
##  $ : num [1:40] -0.636 -2.672 0.123 -1.577 -2.856 ...
##  $ : num [1:45] -1.64 -2.4 -3.53 -3.25 -2.45 ...
##  $ : num [1:50] -1.36 -1.89 -1.33 -1.56 -2.13 ...
##  $ : num [1:55] -1.0461 -0.1376 -2.0475 -0.0659 -2.6435 ...
##  $ : num [1:60] 0.195 -1.183 -2.141 -1.895 -0.337 ...
##  $ : num [1:65] -0.819 -3.159 -1.768 -1.338 -2.244 ...
##  $ : num [1:70] -0.108 -2.975 -0.479 -2.578 -2.613 ...
##  $ : num [1:75] 0.012 0.434 -0.614 -2.189 -1.554 ...
##  $ : num [1:80] -3.151 -1.021 -0.736 -1.115 -2.035 ...
##  $ : num [1:85] -1.364 -2.244 -2.354 -0.367 0.186 ...
##  $ : num [1:90] -2.58 -2.18 -2.28 -2.74 -1.62 ...
##  $ : num [1:95] -1.078 -0.713 -1.513 -1.583 -0.839 ...
##  $ : num [1:100] -1.803 -1.168 -0.869 -0.521 -2.269 ...
##  $ : num [1:105] -0.436 -1.416 -0.158 -2.48 -2.416 ...
##  $ : num [1:110] -1.905 -1.526 -0.118 -1.213 -0.627 ...
##  $ : num [1:115] -1.75 -1.2 -1.89 -2.89 -0.99 ...
##  $ : num [1:120] -2.633 -1.549 -2.24 -0.825 -3.373 ...
##  $ : num [1:125] -0.923 -0.646 -2.449 -2.762 -0.766 ...
##  $ : num [1:130] 0.0499 -1.8309 -1.0438 -1.8254 -0.6894 ...
##  $ : num [1:135] -1.909 0.739 -1.684 -1.828 -3.054 ...
##  $ : num [1:140] -1.43 -2.66 -0.8 -2.92 -1.92 ...
##  $ : num [1:145] -1.56 -1.972 -1.942 -0.902 -2.343 ...
##  $ : num [1:150] -2.562 -0.034 -2.646 -2.197 -2.037 ...
##  $ : num [1:5] -1.91 -1.56 -2.12 -1.67 -1.92
##  $ : num [1:10] -2.101 -1.797 -0.997 0.462 -2.621 ...
##  $ : num [1:15] -1.85 -1.37 -2.47 -2.81 -1.89 ...
##  $ : num [1:20] 0.314 0.0206 -1.9756 -1.0913 -1.2208 ...
##  $ : num [1:25] -2.335 -1.536 -1.16 -2.65 -0.193 ...
##  $ : num [1:30] -2.2693 -1.8848 -1.1109 -1.0861 -0.0575 ...
##  $ : num [1:35] -1.188 -1.03 -2.519 0.368 -1.199 ...
##  $ : num [1:40] 0.0101 0.9568 -0.3161 -2.64 -0.3798 ...
##  $ : num [1:45] -1.161 -1.935 -0.852 -0.696 0.644 ...
##  $ : num [1:50] 0.2759 -1.9136 -3.2756 0.0449 -0.9204 ...
##  $ : num [1:55] -1.292 -1.738 -1.269 0.184 0.39 ...
##  $ : num [1:60] -1.414 0.357 -0.674 -1.91 -0.298 ...
##  $ : num [1:65] -1.992 -1.238 -2.509 -1.902 -0.773 ...
##  $ : num [1:70] -0.169 -1.133 -1.959 -0.862 -2.313 ...
##  $ : num [1:75] -1.115 -2.963 -0.984 -1.009 -2.177 ...
##  $ : num [1:80] -2.28 -2.17 -1.81 -2.12 -3.3 ...
##  $ : num [1:85] -2.372 -0.969 -0.347 -1.936 -1.934 ...
##  $ : num [1:90] 1.077 -3.52 -3.59 -1.816 0.139 ...
##  $ : num [1:95] -2.013 -1.97 -2.595 -1.794 -0.427 ...
##  $ : num [1:100] -1.343 -1.025 -0.195 -0.188 -1.603 ...
##  $ : num [1:105] -2.94 -2.62 -3.37 -1.61 -1.78 ...
##  $ : num [1:110] 0.558 -0.857 -1.484 -0.297 -2.824 ...
##  $ : num [1:115] -1.4 -1.191 -2.075 -0.903 -1.355 ...
##  $ : num [1:120] -1.482 -0.722 -2.98 -2.527 -2.343 ...
##  $ : num [1:125] -0.802 -3.923 -1.893 -1.395 -1.882 ...
##  $ : num [1:130] -4.27 -0.612 -1.231 -2.362 -2.908 ...
##  $ : num [1:135] -1.223 -1.652 -0.942 0.748 -2.859 ...
##  $ : num [1:140] -0.198 -2.182 -1.538 -0.999 -1.708 ...
##  $ : num [1:145] 0.0872 -3.2373 -2.8485 -2.7119 -0.8491 ...
##  $ : num [1:150] -0.0859 -3.9639 -2.0948 -1.8192 -0.9861 ...
##  $ : num [1:5] -2.3498 -0.1721 -2.9337 0.0744 -0.733
##  $ : num [1:10] -1.8357 -0.5962 -1.0841 0.3703 0.0584 ...
##  $ : num [1:15] -0.464 -1.466 -1.869 -0.948 -0.365 ...
##  $ : num [1:20] -1.6488 -1.2916 -0.4722 -0.0223 -1.3542 ...
##  $ : num [1:25] -0.919 -0.279 -0.633 -1.675 -0.491 ...
##  $ : num [1:30] -1.71 -2.49 -1.91 -1.08 -1.13 ...
##  $ : num [1:35] -0.556 -1.111 -0.134 -0.301 -1.167 ...
##  $ : num [1:40] -1.78 -1.39 -3.16 -1.11 -1.41 ...
##  $ : num [1:45] -0.425 -1.454 -0.586 0.375 -2.245 ...
##   [list output truncated]
```

---
# Alternative spec


```r
fsim &lt;- pmap(list(full_conditions$n,
                  full_conditions$mu,
                  full_conditions$sd),
            ~rnorm(n = ..1, mean = ..2, sd = ..3))
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -1.31 -1.7 -2.28 -2.74 -3.64
##  $ : num [1:10] -0.912 -3.564 -0.423 -2.007 -1.495 ...
##  $ : num [1:15] -0.000766 -1.554821 -2.637812 -3.724621 -1.072218 ...
##  $ : num [1:20] -2.43 -1.07 -3.48 -2.61 -2.5 ...
##  $ : num [1:25] -2.64 -0.951 -0.209 -1.612 -0.272 ...
##  $ : num [1:30] -2.04 -2.6 -2.52 -1.93 -2.16 ...
##  $ : num [1:35] 0.06 -3.41 -5.2 -2.44 -2.6 ...
##  $ : num [1:40] -1.98 -2.77 -2.19 -1.32 -2.53 ...
##  $ : num [1:45] -1.25 -2.605 -1.634 -0.745 -2.2 ...
##  $ : num [1:50] -3.886 -0.954 -2.494 -0.984 -2.277 ...
##  $ : num [1:55] -2.72 -2.16 -1.08 -2.39 -3.12 ...
##  $ : num [1:60] -3.24 -4.04 -1.49 -2.21 -1.78 ...
##  $ : num [1:65] -0.549 -1.509 -2.678 -3.007 -1.95 ...
##  $ : num [1:70] -2.39 -5.34 -2.02 -1.42 -1.81 ...
##  $ : num [1:75] -1.536 0.881 -1.402 -0.694 -0.929 ...
##  $ : num [1:80] -1.44 -2.37 -1.76 -3.5 -2.36 ...
##  $ : num [1:85] -1.51 -2.61 -1.69 -3.3 -1.22 ...
##  $ : num [1:90] -2.913 -0.726 -2.232 -4.689 -3.177 ...
##  $ : num [1:95] -1.67 -0.576 -2.252 -1.238 -2.698 ...
##  $ : num [1:100] -3.201 -0.553 -2.042 -0.809 -0.863 ...
##  $ : num [1:105] -2.9 -3.47 -3.06 -1.89 -2.64 ...
##  $ : num [1:110] -2.76 -2.96 -1.32 -1.21 -3.15 ...
##  $ : num [1:115] -0.333 -1.708 -2.667 -0.519 -1.084 ...
##  $ : num [1:120] -1.855 -0.725 -1.541 -2.551 -1.455 ...
##  $ : num [1:125] -2.2 -1.95 -1.4 -3.24 -2.08 ...
##  $ : num [1:130] -2.25 -2.44 -2.48 -1.43 -1.6 ...
##  $ : num [1:135] -2.36 -4.73 -1.52 -2.17 -2.46 ...
##  $ : num [1:140] -2.04 -2.49 -1.87 -4.14 -1.13 ...
##  $ : num [1:145] -3.114 -1.29 -0.831 -1.217 -1.709 ...
##  $ : num [1:150] -1.37 -1.42 -1.44 -1.77 -3.47 ...
##  $ : num [1:5] -0.865 -0.393 -1.687 -0.606 -3.216
##  $ : num [1:10] -1.128 -0.513 -2.377 -1.462 -2.798 ...
##  $ : num [1:15] -4.68 -1.88 -1.88 -3.07 -1.19 ...
##  $ : num [1:20] -1.266 -1.728 -1.442 -0.561 -1.495 ...
##  $ : num [1:25] -2.825 -1.037 -1.257 -2.147 -0.529 ...
##  $ : num [1:30] -1.09 -2.86 -1.79 -1.15 -2.24 ...
##  $ : num [1:35] -2.015 -0.225 -0.833 -2.578 -1.775 ...
##  $ : num [1:40] -0.978 -1.22 -2.621 -1.303 -2.046 ...
##  $ : num [1:45] 2.12 -2 -2.1 -2.66 1.59 ...
##  $ : num [1:50] -0.45 -1.46 -2.05 -1.42 -2.4 ...
##  $ : num [1:55] -0.534 0.117 -2.868 -0.08 -2.283 ...
##  $ : num [1:60] -2.84 -1.42 -0.37 -1.1 -3.31 ...
##  $ : num [1:65] -1.824 -1.48 -0.431 -2.037 -2.343 ...
##  $ : num [1:70] -2.35 -2.03 -1.97 -1.84 -1.65 ...
##  $ : num [1:75] -2.474 -2.009 -0.876 -0.802 -3.601 ...
##  $ : num [1:80] -1.04 -1.53 -1.33 -2.54 -3.08 ...
##  $ : num [1:85] -2.385 -2.093 -1.594 -0.579 0.43 ...
##  $ : num [1:90] -1.744 -2.8 -0.907 -0.066 -0.837 ...
##  $ : num [1:95] -2.398 0.418 -3.399 -2.13 -2.312 ...
##  $ : num [1:100] -0.782 -2.302 -2.115 -1.704 -1.434 ...
##  $ : num [1:105] -2.379 -1.998 -1.547 -0.336 -1.257 ...
##  $ : num [1:110] -3.079 -2.148 -0.424 -1.762 -3.499 ...
##  $ : num [1:115] -1.25 -4.91 -3.33 -1.66 -2.11 ...
##  $ : num [1:120] -1.007 -1.397 -3.074 -0.699 -3.733 ...
##  $ : num [1:125] -1.0029 0.0638 -1.1768 -2.5323 -2.4083 ...
##  $ : num [1:130] -0.642 -3.67 -2.657 -3.413 -1.29 ...
##  $ : num [1:135] -2.79 -1.94 -2.94 -2.16 -2.75 ...
##  $ : num [1:140] -2.748 -1.059 -1.17 -0.924 -2.306 ...
##  $ : num [1:145] -2.285 -1.649 -2.147 -0.538 -0.911 ...
##  $ : num [1:150] -2.751 -0.917 -2.438 -0.899 -2.338 ...
##  $ : num [1:5] -1.936 -0.341 -1.722 -2.715 -1.788
##  $ : num [1:10] -0.214 -1.501 -1.661 -0.572 -0.538 ...
##  $ : num [1:15] -2.16 -2.07 -1.07 -1.62 -1.03 ...
##  $ : num [1:20] -1.414 -2.859 0.559 -1.024 -1.387 ...
##  $ : num [1:25] -1.3158 0.2869 -0.0602 -1.6219 -1.6364 ...
##  $ : num [1:30] -1.325 -0.606 -1.3327 -0.0374 -0.0333 ...
##  $ : num [1:35] -3.518 0.834 -1.713 -2.267 -2.121 ...
##  $ : num [1:40] -1.47 -1.12 -1.22 -2.71 -1.69 ...
##  $ : num [1:45] -4.004 -2.115 -0.703 -1.927 -0.833 ...
##  $ : num [1:50] -3.1 -2.15 -2.37 -2.28 -3.19 ...
##  $ : num [1:55] -0.179 0.212 -1.913 -2.513 -0.585 ...
##  $ : num [1:60] -2.1 -1.08 -1.4 -2.06 -2.65 ...
##  $ : num [1:65] -1.232 -1.447 -0.405 -1.367 -2.5 ...
##  $ : num [1:70] -1.85 -2.28 -1.86 -1.21 -3.02 ...
##  $ : num [1:75] -1.755 -2.704 0.441 -2.049 -2.006 ...
##  $ : num [1:80] -0.5065 -2.4122 -0.8771 -0.0357 -1.0297 ...
##  $ : num [1:85] -1.43 -1.853 -1.697 -2.091 -0.587 ...
##  $ : num [1:90] -2.42 -1.85 -1.97 -1.84 -1.72 ...
##  $ : num [1:95] -0.918 -2.934 -2.328 -1.493 -1.588 ...
##  $ : num [1:100] -0.3743 -1.5864 0.0825 -0.8999 -1.837 ...
##  $ : num [1:105] -2.442 -1.831 -3.058 -0.246 -1.119 ...
##  $ : num [1:110] -0.926 -2.897 -0.588 -1.257 -1.365 ...
##  $ : num [1:115] -0.122 -2.435 -0.922 -3.482 -1.115 ...
##  $ : num [1:120] -1.684 0.665 -1.536 -1.612 -1.96 ...
##  $ : num [1:125] -2.247 -0.958 0.368 -1.249 -1.816 ...
##  $ : num [1:130] -1.57 -3.25 -1.83 -1.59 -2.05 ...
##  $ : num [1:135] -2.716 -1.256 -2.916 -0.951 -0.574 ...
##  $ : num [1:140] -1.077 -1.366 -1.783 -1.402 -0.878 ...
##  $ : num [1:145] -2.903 -2.617 -1.147 -0.544 -1.748 ...
##  $ : num [1:150] -3.071 -2.578 -2.288 -0.975 -3.01 ...
##  $ : num [1:5] 0.581 -0.318 -0.369 -0.256 -2.952
##  $ : num [1:10] -0.747 -1.01 -1.588 -2.036 -1.573 ...
##  $ : num [1:15] -0.133 -2.196 -0.829 -2.406 -1.362 ...
##  $ : num [1:20] -1.2754 -0.0598 0.4346 0.1769 -2.2219 ...
##  $ : num [1:25] -1.76 -1.92 -1.09 0.66 -2.06 ...
##  $ : num [1:30] -2.413 -2.914 -2.801 -1.636 -0.971 ...
##  $ : num [1:35] -0.265 -1.131 -0.151 -0.983 -0.883 ...
##  $ : num [1:40] -1.29 0.16 0.27 -0.237 -1.395 ...
##  $ : num [1:45] -1.963 -3.617 -1.385 -1.284 -0.936 ...
##   [list output truncated]
```

---
# Simpler
### Maybe a little too clever
* A data frame is a list so...


```r
fsim &lt;- pmap(full_conditions, ~rnorm(n = ..1, 
                                     mean = ..2, 
                                     sd = ..3))
str(fsim)
```

```
## List of 10710
##  $ : num [1:5] -3.106 -0.326 -1.061 -1.601 -2.289
##  $ : num [1:10] -3.88 -1.62 -2.55 -2.4 -2.06 ...
##  $ : num [1:15] -1.606 -0.922 -1.228 -1.923 -1.35 ...
##  $ : num [1:20] -1.7 -3.89 -1.95 -1.36 -1.15 ...
##  $ : num [1:25] -0.202 -2.365 -4.003 -0.453 -2.428 ...
##  $ : num [1:30] -2.5 -1.48 -1.72 -1.76 -1.35 ...
##  $ : num [1:35] -3.04 -2.34 -1.74 -2.81 -1.71 ...
##  $ : num [1:40] -0.724 -3.465 -1.934 -1.243 -2 ...
##  $ : num [1:45] -1.66 -1.92 -2.69 -2.12 -3.21 ...
##  $ : num [1:50] -2.737 -2.7 -1.259 -0.448 -2.621 ...
##  $ : num [1:55] -2.34 -2.79 -1.5 -1.51 -1.35 ...
##  $ : num [1:60] -2.11 -0.551 -2.14 -0.394 -3.164 ...
##  $ : num [1:65] -1.6085 -1.8397 -0.6344 -0.0163 0.4434 ...
##  $ : num [1:70] -2.278 -3.166 -1.829 -1.221 -0.257 ...
##  $ : num [1:75] -2.42 -3.78 -1.94 -2.93 -2.81 ...
##  $ : num [1:80] -0.646 -2.335 -0.91 -2.558 -1.308 ...
##  $ : num [1:85] -2.49 -2.2 -0.83 -2.85 -2.06 ...
##  $ : num [1:90] -0.617 -2.02 -0.984 -1.821 -1.434 ...
##  $ : num [1:95] -1.75 -2.426 -0.829 -0.647 -2.094 ...
##  $ : num [1:100] -1.63 -3.31 -3.5 -2.62 -1.38 ...
##  $ : num [1:105] -2.28 -2.6 -2.01 -1.93 -4.02 ...
##  $ : num [1:110] -2.56 -1.21 -1.35 -2.38 -2.44 ...
##  $ : num [1:115] -2.852 -2.297 -3.292 -1.96 -0.479 ...
##  $ : num [1:120] -1.6 -3.26 -2.06 -2.82 -2.66 ...
##  $ : num [1:125] -2.131 -1.852 -3.798 0.245 -0.693 ...
##  $ : num [1:130] -1.681 -2.47 -0.84 -0.824 -2.474 ...
##  $ : num [1:135] -3.14 -2.1 -2.3 -3.49 -2.62 ...
##  $ : num [1:140] -1.322 -1.573 -0.969 -0.643 -0.954 ...
##  $ : num [1:145] -1.981 -0.852 -2.842 -1.141 -3.358 ...
##  $ : num [1:150] -1.31 -3.01 -2.14 -3.09 -2.42 ...
##  $ : num [1:5] -1.685 -3.209 -0.428 -2.351 -1.663
##  $ : num [1:10] -0.86 -0.985 -2.495 -2.957 -1.732 ...
##  $ : num [1:15] -2.053 -3.264 -1.616 -0.548 -1.491 ...
##  $ : num [1:20] -2.05 -2.124 0.472 -2.297 -0.907 ...
##  $ : num [1:25] -2.184 -3.824 -0.785 -0.34 0.676 ...
##  $ : num [1:30] -2.126 -2.945 0.756 0.53 -3.467 ...
##  $ : num [1:35] -0.972 -1.18 -0.773 -1.35 -2.722 ...
##  $ : num [1:40] -0.574 -3.948 -0.703 -0.104 -0.699 ...
##  $ : num [1:45] -0.208 -1.553 -1.688 -2.416 -1.696 ...
##  $ : num [1:50] -1.32 -1.22 -1.03 -1.35 -1.35 ...
##  $ : num [1:55] -1.317 -3.066 -2.13 -0.932 -2.251 ...
##  $ : num [1:60] -1.66 -1.27 -1.76 -2.58 -1.57 ...
##  $ : num [1:65] -1.1 -3.26 -1.66 1.11 -1.72 ...
##  $ : num [1:70] -2.6924 -3.0849 0.0492 -1.6753 -3.0364 ...
##  $ : num [1:75] -2.282 -1.656 -1.521 -0.825 -2.146 ...
##  $ : num [1:80] -1.408 -0.747 -0.786 -2.601 -2.39 ...
##  $ : num [1:85] -2.85 -3.17 -2.18 -2.51 -1.35 ...
##  $ : num [1:90] -1.19 -3.11 -1.63 -2.14 -1.74 ...
##  $ : num [1:95] -3.0782 0.0446 -1.5372 -3.2219 0.4059 ...
##  $ : num [1:100] -2.751 -0.144 -3.031 -3.27 -0.613 ...
##  $ : num [1:105] -0.681 -1.183 -3.303 -2.235 -2.054 ...
##  $ : num [1:110] -1.03 -2.6 -2.36 -2.34 -1.26 ...
##  $ : num [1:115] -3.31374 -1.72383 0.00585 -0.95593 -2.65296 ...
##  $ : num [1:120] -1.9 -2.101 -2.166 -0.783 -3.017 ...
##  $ : num [1:125] -1.126 -1.386 -1.593 -0.951 -2.66 ...
##  $ : num [1:130] -0.601 -0.535 -3.993 -3.635 -0.121 ...
##  $ : num [1:135] -1.62 -2.61 -3.62 -2.95 -2.8 ...
##  $ : num [1:140] -2.23 -2.24 -1.84 -1.15 -1.61 ...
##  $ : num [1:145] -1.56 -0.43 -1.37 -1 -2.11 ...
##  $ : num [1:150] -2.493 -1.296 -2.254 -0.688 -2.642 ...
##  $ : num [1:5] -1.742 -0.819 -1.083 0.128 -1.754
##  $ : num [1:10] -0.5 -1.96 -2.22 -1.85 -1.52 ...
##  $ : num [1:15] -3.468 -1.987 -1.747 -0.671 -2.204 ...
##  $ : num [1:20] -1.9 -2.07 -1.98 -2.43 0.6 ...
##  $ : num [1:25] -2.18 -1.57 -1.566 -1.366 -0.696 ...
##  $ : num [1:30] -1.0129 0.0238 -0.8201 -1.4356 -1.0454 ...
##  $ : num [1:35] -1.249 -1.342 -1.005 0.186 -0.277 ...
##  $ : num [1:40] -1.403 -0.611 -0.792 -2.991 -1.733 ...
##  $ : num [1:45] -1.393 -0.718 -2.217 -1.805 -1.258 ...
##  $ : num [1:50] -1.294 -1.886 -2.528 -0.207 -0.601 ...
##  $ : num [1:55] -0.604 -1.959 -1.802 -1.778 -0.907 ...
##  $ : num [1:60] -1.472 0.964 -1.989 -1.963 -1.966 ...
##  $ : num [1:65] -1.935 0.325 -2.183 -0.18 -1.506 ...
##  $ : num [1:70] -0.998 -1.169 -2.556 -3.195 -1.296 ...
##  $ : num [1:75] -2.698 -1.9 0.125 -1.358 -1.609 ...
##  $ : num [1:80] -2.0226 -1.7295 -1.7145 -1.9148 -0.0954 ...
##  $ : num [1:85] -1.597 0.207 -3.868 -2.198 -0.856 ...
##  $ : num [1:90] 0.316 -2.316 -2.431 -0.81 -1.164 ...
##  $ : num [1:95] -1.296 1.607 -2.226 -0.787 0.137 ...
##  $ : num [1:100] -2.4711 -0.0696 -1.4799 -2.0862 -1.8723 ...
##  $ : num [1:105] -0.922 -1.318 -0.103 -0.151 -1.029 ...
##  $ : num [1:110] -0.6162 -1.2978 0.1455 0.0146 -3.1267 ...
##  $ : num [1:115] -1.35 -2.19 -2.58 -3.33 -3.15 ...
##  $ : num [1:120] -2.608 1.188 -3.037 -1.854 0.248 ...
##  $ : num [1:125] -2.04 -1.85 -4.15 -1.88 -3.3 ...
##  $ : num [1:130] -0.5 -1.155 -0.595 -2.589 -2.416 ...
##  $ : num [1:135] -3.5404 -0.7161 -1.1272 -2.0147 0.0694 ...
##  $ : num [1:140] -2.0415 -2.9387 -1.2485 -0.0515 -1.5682 ...
##  $ : num [1:145] -1.27 -2.63 -2.84 -2.8 -1.8 ...
##  $ : num [1:150] -3.588 0.05 -1.565 -0.122 -0.862 ...
##  $ : num [1:5] -2.381 -0.391 -0.971 -1.714 -1.453
##  $ : num [1:10] -1.298 -2.116 -1.813 -0.236 -1.674 ...
##  $ : num [1:15] -0.283 -1.115 -0.722 -2.18 -1.122 ...
##  $ : num [1:20] -0.243 -2.775 -0.713 -2.11 -2.426 ...
##  $ : num [1:25] -0.618 -0.829 -1.571 -1.852 -0.605 ...
##  $ : num [1:30] -0.569 -1.251 -1.743 -1.917 -0.772 ...
##  $ : num [1:35] -1.304 -0.652 -0.174 -2.454 -0.686 ...
##  $ : num [1:40] -1.406 -1.589 -1.579 -0.445 -1.76 ...
##  $ : num [1:45] -0.618 -1.74 0.162 -1.256 -0.446 ...
##   [list output truncated]
```
---
# List column version


```r
full_conditions %&gt;%
	as_tibble() %&gt;%
	mutate(sim = pmap(list(n, mu, sd), ~rnorm(..1, ..2, ..3)))
```

```
## # A tibble: 10,710 x 4
##        n    mu    sd sim       
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;list&gt;    
##  1     5    -2     1 &lt;dbl [5]&gt; 
##  2    10    -2     1 &lt;dbl [10]&gt;
##  3    15    -2     1 &lt;dbl [15]&gt;
##  4    20    -2     1 &lt;dbl [20]&gt;
##  5    25    -2     1 &lt;dbl [25]&gt;
##  6    30    -2     1 &lt;dbl [30]&gt;
##  7    35    -2     1 &lt;dbl [35]&gt;
##  8    40    -2     1 &lt;dbl [40]&gt;
##  9    45    -2     1 &lt;dbl [45]&gt;
## 10    50    -2     1 &lt;dbl [50]&gt;
## # … with 10,700 more rows
```
---
# Unnest

```r
full_conditions %&gt;%
	as_tibble() %&gt;%
	mutate(sim = pmap(list(n, mu, sd), ~rnorm(..1, ..2, ..3))) %&gt;%
	unnest()
```

```
## # A tibble: 830,025 x 4
##        n    mu    sd        sim
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
##  1     5    -2     1 -3.058661 
##  2     5    -2     1 -2.142905 
##  3     5    -2     1 -2.239534 
##  4     5    -2     1 -0.9341582
##  5     5    -2     1 -2.048730 
##  6    10    -2     1 -0.9363105
##  7    10    -2     1 -3.319067 
##  8    10    -2     1 -3.732857 
##  9    10    -2     1 -2.452757 
## 10    10    -2     1 -2.062079 
## # … with 830,015 more rows
```

---
class: inverse center middle
# Plot
Add a caption stating the total number of pulizter prize winners across years

---
# Add column for total


```r
pulitzer &lt;- pulitzer %&gt;%
	group_by(newspaper) %&gt;%
	mutate(tot = sum(n))
pulitzer
```

```
## # A tibble: 100 x 4
## # Groups:   newspaper [50]
##    newspaper           year_range     n   tot
##    &lt;chr&gt;               &lt;chr&gt;      &lt;int&gt; &lt;int&gt;
##  1 USA Today           1990-2003      1     2
##  2 USA Today           2004-2014      1     2
##  3 Wall Street Journal 1990-2003     30    50
##  4 Wall Street Journal 2004-2014     20    50
##  5 New York Times      1990-2003     55   117
##  6 New York Times      2004-2014     62   117
##  7 Los Angeles Times   1990-2003     44    85
##  8 Los Angeles Times   2004-2014     41    85
##  9 Washington Post     1990-2003     52   100
## 10 Washington Post     2004-2014     48   100
## # … with 90 more rows
```

---
# Easiest way (imo)
Create a column to represent exactly the label you want.


```r
#install.packages("english")
library(english)
pulitzer &lt;- pulitzer %&gt;%
	mutate(label = 
    glue("{str_to_title(as.english(tot))} Total Pulitzer Awards"))
pulitzer
```

```
## # A tibble: 100 x 5
## # Groups:   newspaper [50]
##    newspaper          year_range     n   tot label                              
##    &lt;chr&gt;              &lt;chr&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;                              
##  1 USA Today          1990-2003      1     2 Two Total Pulitzer Awards          
##  2 USA Today          2004-2014      1     2 Two Total Pulitzer Awards          
##  3 Wall Street Journ… 1990-2003     30    50 Fifty Total Pulitzer Awards        
##  4 Wall Street Journ… 2004-2014     20    50 Fifty Total Pulitzer Awards        
##  5 New York Times     1990-2003     55   117 One Hundred Seventeen Total Pulitz…
##  6 New York Times     2004-2014     62   117 One Hundred Seventeen Total Pulitz…
##  7 Los Angeles Times  1990-2003     44    85 Eighty-Five Total Pulitzer Awards  
##  8 Los Angeles Times  2004-2014     41    85 Eighty-Five Total Pulitzer Awards  
##  9 Washington Post    1990-2003     52   100 One Hundred Total Pulitzer Awards  
## 10 Washington Post    2004-2014     48   100 One Hundred Total Pulitzer Awards  
## # … with 90 more rows
```

---
# Produce one plot


```r
tmp &lt;- pulitzer %&gt;%
	filter(newspaper == "Wall Street Journal") 

ggplot(tmp, aes(year_range, n)) +
	geom_col(aes(fill = n)) +
	scale_fill_distiller(type = "seq", 
	                     limits = c(0, max(pulitzer$n)),
	                     palette = "BuPu",
	                     direction = 1) +
	ylim(0, max(pulitzer$n)) +
	coord_flip() +
	labs(title = "Pulitzer prize winners: Wall Street Journal",
	     x = "Year Range",
	     caption = unique(tmp$label)) 
```

![](w5p1_files/figure-html/plot-cap1-1.png)&lt;!-- --&gt;

---
# Produce all plots
### Nest first


```r
pulitzer %&gt;%
	group_by(newspaper, label) %&gt;%
	nest() 
```

```
## # A tibble: 50 x 3
## # Groups:   newspaper, label [50]
##    newspaper             label                                   data           
##    &lt;chr&gt;                 &lt;chr&gt;                                   &lt;list&gt;         
##  1 USA Today             Two Total Pulitzer Awards               &lt;tibble [2 × 3…
##  2 Wall Street Journal   Fifty Total Pulitzer Awards             &lt;tibble [2 × 3…
##  3 New York Times        One Hundred Seventeen Total Pulitzer A… &lt;tibble [2 × 3…
##  4 Los Angeles Times     Eighty-Five Total Pulitzer Awards       &lt;tibble [2 × 3…
##  5 Washington Post       One Hundred Total Pulitzer Awards       &lt;tibble [2 × 3…
##  6 New York Daily News   Six Total Pulitzer Awards               &lt;tibble [2 × 3…
##  7 New York Post         Zero Total Pulitzer Awards              &lt;tibble [2 × 3…
##  8 Chicago Tribune       Thirty-Eight Total Pulitzer Awards      &lt;tibble [2 × 3…
##  9 San Jose Mercury News Six Total Pulitzer Awards               &lt;tibble [2 × 3…
## 10 Newsday               Eighteen Total Pulitzer Awards          &lt;tibble [2 × 3…
## # … with 40 more rows
```

---
# Produce plots


```r
final_plots &lt;- pulitzer %&gt;%
	group_by(newspaper, label) %&gt;%
	nest() %&gt;%
	mutate(plots = pmap(list(newspaper, label, data),
*   ~ggplot(..3, aes(year_range, n)) +
    	geom_col(aes(fill = n)) +
    	scale_fill_distiller(type = "seq", 
    	                     limits = c(0, max(pulitzer$n)),
    	                     palette = "BuPu",
    	                     direction = 1) +
    	ylim(0, max(pulitzer$n)) +
    	coord_flip() +
*   	labs(title = glue("Pulitzer prize winners: {..1}"),
    	     x = "Year Range",
*   	     caption = ..2)))
```

---
# Look at a couple plots

.pull-left[

```r
final_plots$plots[[1]]
```

![](w5p1_files/figure-html/p3-1.png)&lt;!-- --&gt;

```r
final_plots$plots[[3]]
```

![](w5p1_files/figure-html/p3-2.png)&lt;!-- --&gt;
]

.pull-right[

```r
final_plots$plots[[2]]
```

![](w5p1_files/figure-html/p4-1.png)&lt;!-- --&gt;

```r
final_plots$plots[[4]]
```

![](w5p1_files/figure-html/p4-2.png)&lt;!-- --&gt;
]

---
# Save all plots

We'll have to iterate across at least two things: (a) file path/names, and (b)
the plots themselves


---
#`walk`

* Why `walk` for saving instead of `map`?

&gt; Walk is an alternative to map that you use when you want to call a function for its side effects, rather than for its return value. You typically do this because you want to render output to the screen or save files to disk - the important thing is the action, not the return value.

\-[r4ds](https://r4ds.had.co.nz/iteration.html#walk)

---
# Example

### Create a directory

```r
fs::dir_create(here::here("plots", "pulitzers"))
```

--
### Create file paths

```r
files &lt;- str_replace_all(tolower(final_plots$newspaper), " ", "-")
paths &lt;- here::here("plots", "pulitzers", glue("{files}.png"))
paths
```

```
##  [1] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/usa-today.png"                   
##  [2] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/wall-street-journal.png"         
##  [3] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/new-york-times.png"              
##  [4] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/los-angeles-times.png"           
##  [5] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/washington-post.png"             
##  [6] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/new-york-daily-news.png"         
##  [7] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/new-york-post.png"               
##  [8] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/chicago-tribune.png"             
##  [9] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/san-jose-mercury-news.png"       
## [10] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/newsday.png"                     
## [11] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/houston-chronicle.png"           
## [12] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/dallas-morning-news.png"         
## [13] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/san-francisco-chronicle.png"     
## [14] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/arizona-republic.png"            
## [15] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/chicago-sun-times.png"           
## [16] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/boston-globe.png"                
## [17] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/atlanta-journal-constitution.png"
## [18] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/newark-star-ledger.png"          
## [19] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/detroit-free-press.png"          
## [20] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/minneapolis-star-tribune.png"    
## [21] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/philadelphia-inquirer.png"       
## [22] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/cleveland-plain-dealer.png"      
## [23] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/san-diego-union-tribune.png"     
## [24] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/tampa-bay-times.png"             
## [25] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/denver-post.png"                 
## [26] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/rocky-mountain-news.png"         
## [27] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/oregonian.png"                   
## [28] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/miami-herald.png"                
## [29] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/orange-county-register.png"      
## [30] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/sacramento-bee.png"              
## [31] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/st.-louis-post-dispatch.png"     
## [32] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/baltimore-sun.png"               
## [33] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/kansas-city-star.png"            
## [34] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/detroit-news.png"                
## [35] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/orlando-sentinel.png"            
## [36] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/south-florida-sun-sentinel.png"  
## [37] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/new-orleans-times-picayune.png"  
## [38] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/columbus-dispatch.png"           
## [39] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/indianapolis-star.png"           
## [40] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/san-antonio-express-news.png"    
## [41] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/pittsburgh-post-gazette.png"     
## [42] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/milwaukee-journal-sentinel.png"  
## [43] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/tampa-tribune.png"               
## [44] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/fort-woth-star-telegram.png"     
## [45] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/boston-herald.png"               
## [46] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/seattle-times.png"               
## [47] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/charlotte-observer.png"          
## [48] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/daily-oklahoman.png"             
## [49] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/louisville-courier-journal.png"  
## [50] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/plots/pulitzers/investor's-buisiness-daily.png"
```

---
# Save plots


```r
walk2(paths, final_plots$plots, ggsave,
      width = 9.5, 
      height = 6.5,
      dpi = 500)
```

---
# A few other functions
### modify

&gt; Unlike `map()` and its variants which always return a fixed object type (list for `map()`, integer vector for `map_int()`, etc), the `modify()` family always returns the same type as the input object.

---
# `map` vs `modify`
### map


```r
map(mtcars, ~as.numeric(scale(.x)))
```

```
## $mpg
##  [1]  0.15088482  0.15088482  0.44954345  0.21725341 -0.23073453 -0.33028740
##  [7] -0.96078893  0.71501778  0.44954345 -0.14777380 -0.38006384 -0.61235388
## [13] -0.46302456 -0.81145962 -1.60788262 -1.60788262 -0.89442035  2.04238943
## [19]  1.71054652  2.29127162  0.23384555 -0.76168319 -0.81145962 -1.12671039
## [25] -0.14777380  1.19619000  0.98049211  1.71054652 -0.71190675 -0.06481307
## [31] -0.84464392  0.21725341
## 
## $cyl
##  [1] -0.1049878 -0.1049878 -1.2248578 -0.1049878  1.0148821 -0.1049878
##  [7]  1.0148821 -1.2248578 -1.2248578 -0.1049878 -0.1049878  1.0148821
## [13]  1.0148821  1.0148821  1.0148821  1.0148821  1.0148821 -1.2248578
## [19] -1.2248578 -1.2248578 -1.2248578  1.0148821  1.0148821  1.0148821
## [25]  1.0148821 -1.2248578 -1.2248578 -1.2248578  1.0148821 -0.1049878
## [31]  1.0148821 -1.2248578
## 
## $disp
##  [1] -0.57061982 -0.57061982 -0.99018209  0.22009369  1.04308123 -0.04616698
##  [7]  1.04308123 -0.67793094 -0.72553512 -0.50929918 -0.50929918  0.36371309
## [13]  0.36371309  0.36371309  1.94675381  1.84993175  1.68856165 -1.22658929
## [19] -1.25079481 -1.28790993 -0.89255318  0.70420401  0.59124494  0.96239618
## [25]  1.36582144 -1.22416874 -0.89093948 -1.09426581  0.97046468 -0.69164740
## [31]  0.56703942 -0.88529152
## 
## $hp
##  [1] -0.53509284 -0.53509284 -0.78304046 -0.53509284  0.41294217 -0.60801861
##  [7]  1.43390296 -1.23518023 -0.75387015 -0.34548584 -0.34548584  0.48586794
## [13]  0.48586794  0.48586794  0.85049680  0.99634834  1.21512565 -1.17683962
## [19] -1.38103178 -1.19142477 -0.72469984  0.04831332  0.04831332  1.43390296
## [25]  0.41294217 -1.17683962 -0.81221077 -0.49133738  1.71102089  0.41294217
## [31]  2.74656682 -0.54967799
## 
## $drat
##  [1]  0.56751369  0.56751369  0.47399959 -0.96611753 -0.83519779 -1.56460776
##  [7] -0.72298087  0.17475447  0.60491932  0.60491932  0.60491932 -0.98482035
## [13] -0.98482035 -0.98482035 -1.24665983 -1.11574009 -0.68557523  0.90416444
## [19]  2.49390411  1.16600392  0.19345729 -1.56460776 -0.83519779  0.24956575
## [25] -0.96611753  0.90416444  1.55876313  0.32437703  1.16600392  0.04383473
## [31] -0.10578782  0.96027290
## 
## $wt
##  [1] -0.610399567 -0.349785269 -0.917004624 -0.002299538  0.227654255
##  [6]  0.248094592  0.360516446 -0.027849959 -0.068730634  0.227654255
## [11]  0.227654255  0.871524874  0.524039143  0.575139986  2.077504765
## [16]  2.255335698  2.174596366 -1.039646647 -1.637526508 -1.412682800
## [21] -0.768812180  0.309415603  0.222544170  0.636460997  0.641571082
## [26] -1.310481114 -1.100967659 -1.741772228 -0.048290296 -0.457097039
## [31]  0.360516446 -0.446876870
## 
## $qsec
##  [1] -0.77716515 -0.46378082  0.42600682  0.89048716 -0.46378082  1.32698675
##  [7] -1.12412636  1.20387148  2.82675459  0.25252621  0.58829513 -0.25112717
## [13] -0.13920420  0.08464175  0.07344945 -0.01608893 -0.23993487  0.90727560
## [19]  0.37564148  1.14790999  1.20946763 -0.54772305 -0.30708866 -1.36476075
## [25] -0.44699237  0.58829513 -0.64285758 -0.53093460 -1.87401028 -1.31439542
## [31] -1.81804880  0.42041067
## 
## $vs
##  [1] -0.8680278 -0.8680278  1.1160357  1.1160357 -0.8680278  1.1160357
##  [7] -0.8680278  1.1160357  1.1160357  1.1160357  1.1160357 -0.8680278
## [13] -0.8680278 -0.8680278 -0.8680278 -0.8680278 -0.8680278  1.1160357
## [19]  1.1160357  1.1160357  1.1160357 -0.8680278 -0.8680278 -0.8680278
## [25] -0.8680278  1.1160357 -0.8680278  1.1160357 -0.8680278 -0.8680278
## [31] -0.8680278  1.1160357
## 
## $am
##  [1]  1.1899014  1.1899014  1.1899014 -0.8141431 -0.8141431 -0.8141431
##  [7] -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431
## [13] -0.8141431 -0.8141431 -0.8141431 -0.8141431 -0.8141431  1.1899014
## [19]  1.1899014  1.1899014 -0.8141431 -0.8141431 -0.8141431 -0.8141431
## [25] -0.8141431  1.1899014  1.1899014  1.1899014  1.1899014  1.1899014
## [31]  1.1899014  1.1899014
## 
## $gear
##  [1]  0.4235542  0.4235542  0.4235542 -0.9318192 -0.9318192 -0.9318192
##  [7] -0.9318192  0.4235542  0.4235542  0.4235542  0.4235542 -0.9318192
## [13] -0.9318192 -0.9318192 -0.9318192 -0.9318192 -0.9318192  0.4235542
## [19]  0.4235542  0.4235542 -0.9318192 -0.9318192 -0.9318192 -0.9318192
## [25] -0.9318192  0.4235542  1.7789276  1.7789276  1.7789276  1.7789276
## [31]  1.7789276  0.4235542
## 
## $carb
##  [1]  0.7352031  0.7352031 -1.1221521 -1.1221521 -0.5030337 -1.1221521
##  [7]  0.7352031 -0.5030337 -0.5030337  0.7352031  0.7352031  0.1160847
## [13]  0.1160847  0.1160847  0.7352031  0.7352031  0.7352031 -1.1221521
## [19] -0.5030337 -1.1221521 -1.1221521 -0.5030337 -0.5030337  0.7352031
## [25] -0.5030337 -1.1221521 -0.5030337 -0.5030337  0.7352031  1.9734398
## [31]  3.2116766 -0.5030337
```

---
### modify


```r
modify(mtcars, ~as.numeric(scale(.x)))
```

```
##                             mpg        cyl        disp          hp        drat
## Mazda RX4            0.15088482 -0.1049878 -0.57061982 -0.53509284  0.56751369
## Mazda RX4 Wag        0.15088482 -0.1049878 -0.57061982 -0.53509284  0.56751369
## Datsun 710           0.44954345 -1.2248578 -0.99018209 -0.78304046  0.47399959
## Hornet 4 Drive       0.21725341 -0.1049878  0.22009369 -0.53509284 -0.96611753
## Hornet Sportabout   -0.23073453  1.0148821  1.04308123  0.41294217 -0.83519779
## Valiant             -0.33028740 -0.1049878 -0.04616698 -0.60801861 -1.56460776
## Duster 360          -0.96078893  1.0148821  1.04308123  1.43390296 -0.72298087
## Merc 240D            0.71501778 -1.2248578 -0.67793094 -1.23518023  0.17475447
## Merc 230             0.44954345 -1.2248578 -0.72553512 -0.75387015  0.60491932
## Merc 280            -0.14777380 -0.1049878 -0.50929918 -0.34548584  0.60491932
## Merc 280C           -0.38006384 -0.1049878 -0.50929918 -0.34548584  0.60491932
## Merc 450SE          -0.61235388  1.0148821  0.36371309  0.48586794 -0.98482035
## Merc 450SL          -0.46302456  1.0148821  0.36371309  0.48586794 -0.98482035
## Merc 450SLC         -0.81145962  1.0148821  0.36371309  0.48586794 -0.98482035
## Cadillac Fleetwood  -1.60788262  1.0148821  1.94675381  0.85049680 -1.24665983
## Lincoln Continental -1.60788262  1.0148821  1.84993175  0.99634834 -1.11574009
## Chrysler Imperial   -0.89442035  1.0148821  1.68856165  1.21512565 -0.68557523
## Fiat 128             2.04238943 -1.2248578 -1.22658929 -1.17683962  0.90416444
## Honda Civic          1.71054652 -1.2248578 -1.25079481 -1.38103178  2.49390411
## Toyota Corolla       2.29127162 -1.2248578 -1.28790993 -1.19142477  1.16600392
## Toyota Corona        0.23384555 -1.2248578 -0.89255318 -0.72469984  0.19345729
## Dodge Challenger    -0.76168319  1.0148821  0.70420401  0.04831332 -1.56460776
## AMC Javelin         -0.81145962  1.0148821  0.59124494  0.04831332 -0.83519779
## Camaro Z28          -1.12671039  1.0148821  0.96239618  1.43390296  0.24956575
## Pontiac Firebird    -0.14777380  1.0148821  1.36582144  0.41294217 -0.96611753
## Fiat X1-9            1.19619000 -1.2248578 -1.22416874 -1.17683962  0.90416444
## Porsche 914-2        0.98049211 -1.2248578 -0.89093948 -0.81221077  1.55876313
## Lotus Europa         1.71054652 -1.2248578 -1.09426581 -0.49133738  0.32437703
## Ford Pantera L      -0.71190675  1.0148821  0.97046468  1.71102089  1.16600392
## Ferrari Dino        -0.06481307 -0.1049878 -0.69164740  0.41294217  0.04383473
## Maserati Bora       -0.84464392  1.0148821  0.56703942  2.74656682 -0.10578782
## Volvo 142E           0.21725341 -1.2248578 -0.88529152 -0.54967799  0.96027290
##                               wt        qsec         vs         am       gear
## Mazda RX4           -0.610399567 -0.77716515 -0.8680278  1.1899014  0.4235542
## Mazda RX4 Wag       -0.349785269 -0.46378082 -0.8680278  1.1899014  0.4235542
## Datsun 710          -0.917004624  0.42600682  1.1160357  1.1899014  0.4235542
## Hornet 4 Drive      -0.002299538  0.89048716  1.1160357 -0.8141431 -0.9318192
## Hornet Sportabout    0.227654255 -0.46378082 -0.8680278 -0.8141431 -0.9318192
## Valiant              0.248094592  1.32698675  1.1160357 -0.8141431 -0.9318192
## Duster 360           0.360516446 -1.12412636 -0.8680278 -0.8141431 -0.9318192
## Merc 240D           -0.027849959  1.20387148  1.1160357 -0.8141431  0.4235542
## Merc 230            -0.068730634  2.82675459  1.1160357 -0.8141431  0.4235542
## Merc 280             0.227654255  0.25252621  1.1160357 -0.8141431  0.4235542
## Merc 280C            0.227654255  0.58829513  1.1160357 -0.8141431  0.4235542
## Merc 450SE           0.871524874 -0.25112717 -0.8680278 -0.8141431 -0.9318192
## Merc 450SL           0.524039143 -0.13920420 -0.8680278 -0.8141431 -0.9318192
## Merc 450SLC          0.575139986  0.08464175 -0.8680278 -0.8141431 -0.9318192
## Cadillac Fleetwood   2.077504765  0.07344945 -0.8680278 -0.8141431 -0.9318192
## Lincoln Continental  2.255335698 -0.01608893 -0.8680278 -0.8141431 -0.9318192
## Chrysler Imperial    2.174596366 -0.23993487 -0.8680278 -0.8141431 -0.9318192
## Fiat 128            -1.039646647  0.90727560  1.1160357  1.1899014  0.4235542
## Honda Civic         -1.637526508  0.37564148  1.1160357  1.1899014  0.4235542
## Toyota Corolla      -1.412682800  1.14790999  1.1160357  1.1899014  0.4235542
## Toyota Corona       -0.768812180  1.20946763  1.1160357 -0.8141431 -0.9318192
## Dodge Challenger     0.309415603 -0.54772305 -0.8680278 -0.8141431 -0.9318192
## AMC Javelin          0.222544170 -0.30708866 -0.8680278 -0.8141431 -0.9318192
## Camaro Z28           0.636460997 -1.36476075 -0.8680278 -0.8141431 -0.9318192
## Pontiac Firebird     0.641571082 -0.44699237 -0.8680278 -0.8141431 -0.9318192
## Fiat X1-9           -1.310481114  0.58829513  1.1160357  1.1899014  0.4235542
## Porsche 914-2       -1.100967659 -0.64285758 -0.8680278  1.1899014  1.7789276
## Lotus Europa        -1.741772228 -0.53093460  1.1160357  1.1899014  1.7789276
## Ford Pantera L      -0.048290296 -1.87401028 -0.8680278  1.1899014  1.7789276
## Ferrari Dino        -0.457097039 -1.31439542 -0.8680278  1.1899014  1.7789276
## Maserati Bora        0.360516446 -1.81804880 -0.8680278  1.1899014  1.7789276
## Volvo 142E          -0.446876870  0.42041067  1.1160357  1.1899014  0.4235542
##                           carb
## Mazda RX4            0.7352031
## Mazda RX4 Wag        0.7352031
## Datsun 710          -1.1221521
## Hornet 4 Drive      -1.1221521
## Hornet Sportabout   -0.5030337
## Valiant             -1.1221521
## Duster 360           0.7352031
## Merc 240D           -0.5030337
## Merc 230            -0.5030337
## Merc 280             0.7352031
## Merc 280C            0.7352031
## Merc 450SE           0.1160847
## Merc 450SL           0.1160847
## Merc 450SLC          0.1160847
## Cadillac Fleetwood   0.7352031
## Lincoln Continental  0.7352031
## Chrysler Imperial    0.7352031
## Fiat 128            -1.1221521
## Honda Civic         -0.5030337
## Toyota Corolla      -1.1221521
## Toyota Corona       -1.1221521
## Dodge Challenger    -0.5030337
## AMC Javelin         -0.5030337
## Camaro Z28           0.7352031
## Pontiac Firebird    -0.5030337
## Fiat X1-9           -1.1221521
## Porsche 914-2       -0.5030337
## Lotus Europa        -0.5030337
## Ford Pantera L       0.7352031
## Ferrari Dino         1.9734398
## Maserati Bora        3.2116766
## Volvo 142E          -0.5030337
```


---


```r
modify2(LETTERS[1:3], letters[1:3], paste0)
```

```
## [1] "Aa" "Bb" "Cc"
```

```r
map2(LETTERS[1:3], letters[1:3], paste0)
```

```
## [[1]]
## [1] "Aa"
## 
## [[2]]
## [1] "Bb"
## 
## [[3]]
## [1] "Cc"
```

---
## Iterating when errors are possible

Sometimes a loop will work for most cases, but return an error on a few


--
Often, you want to return the output you can


--
Alternatively, you might want to diagnose *where* the error is occuring


--
`purrr::safely`


---
# Example

```r
by_cyl &lt;- mpg %&gt;% 
  group_by(cyl) %&gt;% 
  nest() 
by_cyl
```

```
## # A tibble: 4 x 2
## # Groups:   cyl [4]
##     cyl data              
##   &lt;int&gt; &lt;list&gt;            
## 1     4 &lt;tibble [81 × 10]&gt;
## 2     6 &lt;tibble [79 × 10]&gt;
## 3     8 &lt;tibble [70 × 10]&gt;
## 4     5 &lt;tibble [4 × 10]&gt;
```


--


```r
by_cyl %&gt;% 
  mutate(mod = map(data, ~lm(hwy ~ displ + drv, data = .x)))
```

```
## Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels
```

---
# Safe return

* First, define safe function - note that this will work for .ital[.b[any]] function

```r
safe_lm &lt;- safely(lm)
```


--

* Next, loop the safe function, instead of the standard function


--


```r
safe_models &lt;- by_cyl %&gt;% 
  mutate(safe_mod = map(data, ~safe_lm(hwy ~ displ + drv, data = .x)))
safe_models
```

```
## # A tibble: 4 x 3
## # Groups:   cyl [4]
##     cyl data               safe_mod        
##   &lt;int&gt; &lt;list&gt;             &lt;list&gt;          
## 1     4 &lt;tibble [81 × 10]&gt; &lt;named list [2]&gt;
## 2     6 &lt;tibble [79 × 10]&gt; &lt;named list [2]&gt;
## 3     8 &lt;tibble [70 × 10]&gt; &lt;named list [2]&gt;
## 4     5 &lt;tibble [4 × 10]&gt;  &lt;named list [2]&gt;
```

---
# What's returned?


```r
safe_models$safe_mod[[1]]
```

```
## $result
## 
## Call:
## .f(formula = ..1, data = ..2)
## 
## Coefficients:
## (Intercept)        displ         drvf  
##      37.370       -5.289        3.882  
## 
## 
## $error
## NULL
```

```r
safe_models$safe_mod[[4]]
```

```
## $result
## NULL
## 
## $error
## &lt;simpleError in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels&gt;
```

---
# Pull results that worked


```r
safe_models %&gt;% 
  mutate(results = map(safe_mod, ~.x[["result"]]))
```

```
## # A tibble: 4 x 4
## # Groups:   cyl [4]
##     cyl data               safe_mod         results
##   &lt;int&gt; &lt;list&gt;             &lt;list&gt;           &lt;list&gt; 
## 1     4 &lt;tibble [81 × 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 2     6 &lt;tibble [79 × 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 3     8 &lt;tibble [70 × 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 4     5 &lt;tibble [4 × 10]&gt;  &lt;named list [2]&gt; &lt;NULL&gt;
```

---
# Pluck alternative
`purrr::pluck` is an alternative to `.x[[]]`


```r
safe_models %&gt;% 
  mutate(results = map(safe_mod, ~pluck(.x, "result")))
```

```
## # A tibble: 4 x 4
## # Groups:   cyl [4]
##     cyl data               safe_mod         results
##   &lt;int&gt; &lt;list&gt;             &lt;list&gt;           &lt;list&gt; 
## 1     4 &lt;tibble [81 × 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 2     6 &lt;tibble [79 × 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 3     8 &lt;tibble [70 × 10]&gt; &lt;named list [2]&gt; &lt;lm&gt;   
## 4     5 &lt;tibble [4 × 10]&gt;  &lt;named list [2]&gt; &lt;NULL&gt;
```

---
# Wrap-up
* Lots more to `{purrr}` but we've covered a lot
  
* Functional programming can *really* help your efficiency, and even if it slows you down initially, I'd recommend always striving toward it, because it will ultimately be a huge help.


.center[

### Questions?

]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atelier-dune-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
