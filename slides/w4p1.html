<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Batch loading data</title>
    <meta charset="utf-8" />
    <meta name="author" content="Daniel Anderson" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/uo-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Batch loading data
### Daniel Anderson
### Week 4, Class 1

---




# Agenda
* Discuss the midterm

	+ Canvas quiz (10 points; please don't stress)

	+ Take home (40 points)

* Review Lab 1

* `map_df` and batch-loading data

* Introduce list columns

---
# Learning objectives
* Understand when `map_df` can and should be applied

* Better understand file paths, and how `{fs}` can help

* Be able to batch load data of a specific type within a mixed-type directory

* Use filenames to pull data

---
class: inverse center middle
# Midterm
### Questions?
### Let's look at the take-home portion

---
class: inverse center middle
# Review Lab 1

---
# `map_df`
* If each iteration returns a data frame, you can use `map_df` to automatically bind all the data frames together.

---
# Example
* Create a function that simulates data


```r
set.seed(8675309)
simulate &lt;- function(n, mean = 0, sd = 1) {
	tibble(sample_id = seq_len(n),
	       sample = rnorm(n, mean, sd))
}
simulate(10)
```

```
## # A tibble: 10 x 2
##    sample_id      sample
##        &lt;int&gt;       &lt;dbl&gt;
##  1         1 -0.9965824 
##  2         2  0.7218241 
##  3         3 -0.6172088 
##  4         4  2.029392  
##  5         5  1.065416  
##  6         6  0.9872197 
##  7         7  0.02745393
##  8         8  0.6728723 
##  9         9  0.5720665 
## 10        10  0.9036777
```

---
# Two more quick examples

```r
simulate(3, 100, 10)
```

```
## # A tibble: 3 x 2
##   sample_id    sample
##       &lt;int&gt;     &lt;dbl&gt;
## 1         1  84.50448
## 2         2 110.2264 
## 3         3 101.5008
```

```r
simulate(5, -10, 1.5)
```

```
## # A tibble: 5 x 2
##   sample_id     sample
##       &lt;int&gt;      &lt;dbl&gt;
## 1         1 -10.98995 
## 2         2 -11.49188 
## 3         3  -7.041312
## 4         4 -10.66270 
## 5         5 -11.35096
```

---
# Simulation
* Assume we want to vary the sample size from 10 to 150 by increments of 5
* `mean` stays constant at 100, `sd` is constant at 10


--
### Try with `purrr::map`

---

```r
library(tidyverse)
sims &lt;- map(seq(10, 150, 5), simulate, 100, 10)
```

.pull-left[

```r
sims[1]
```

```
## [[1]]
## # A tibble: 10 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1  98.49412
##  2         2  91.72106
##  3         3 119.8583 
##  4         4 100.4401 
##  5         5  95.95718
##  6         6  95.27001
##  7         7  95.85177
##  8         8 106.8323 
##  9         9 106.9020 
## 10        10 105.3349
```
]

.pull-right[

```r
sims[2]
```

```
## [[1]]
## # A tibble: 15 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1  98.13895
##  2         2 103.8295 
##  3         3 103.7618 
##  4         4 111.5353 
##  5         5 115.7490 
##  6         6 105.8853 
##  7         7  93.84955
##  8         8  97.71089
##  9         9 100.6392 
## 10        10  96.86526
## 11        11  97.51501
## 12        12  98.46205
## 13        13  93.64743
## 14        14  99.96206
## 15        15 100.4562
```
]

---
# Swap for `map_df`
### Try it - what happens?

--

```r
sims_df &lt;- map_df(seq(10, 150, 5), simulate, 100, 10)
sims_df
```

```
## # A tibble: 2,320 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1  85.54570
##  2         2 106.3168 
##  3         3 104.0324 
##  4         4 101.5233 
##  5         5  91.59920
##  6         6 104.0884 
##  7         7  78.76614
##  8         8  98.77716
##  9         9 102.0655 
## 10        10  86.70270
## # â€¦ with 2,310 more rows
```

---
# Notice a problem here


```r
sims_df[1:15, ]
```

```
## # A tibble: 15 x 2
##    sample_id    sample
##        &lt;int&gt;     &lt;dbl&gt;
##  1         1  85.54570
##  2         2 106.3168 
##  3         3 104.0324 
##  4         4 101.5233 
##  5         5  91.59920
##  6         6 104.0884 
##  7         7  78.76614
##  8         8  98.77716
##  9         9 102.0655 
## 10        10  86.70270
## 11         1 105.5784 
## 12         2  90.25650
## 13         3 109.1115 
## 14         4  83.91135
## 15         5 104.9615
```

---
# `.id` argument


```r
sims_df2 &lt;- map_df(seq(10, 150, 5), simulate, 100, 10, 
                   .id = "iteration")
sims_df2[1:14, ]
```

```
## # A tibble: 14 x 3
##    iteration sample_id    sample
##    &lt;chr&gt;         &lt;int&gt;     &lt;dbl&gt;
##  1 1                 1 104.5238 
##  2 1                 2 102.3434 
##  3 1                 3  97.74519
##  4 1                 4 102.8990 
##  5 1                 5  87.31942
##  6 1                 6 104.6364 
##  7 1                 7  95.73026
##  8 1                 8  97.63699
##  9 1                 9 106.7342 
## 10 1                10  96.21795
## 11 2                 1  98.88162
## 12 2                 2 102.9807 
## 13 2                 3  91.71561
## 14 2                 4 108.1394
```

---
class: middle inverse

&gt; `.id`: Either a string or NULL. If a string, the output will contain a
variable with that name, storing either the name (if .x is named) or the index (if .x is unnamed) of the input. If NULL, the default, no variable will be created.

\- [{purrr} documentation](https://purrr.tidyverse.org/reference/map.html)

---
# setNames


```r
sample_size &lt;- seq(10, 150, 5)
sample_size
```

```
##  [1]  10  15  20  25  30  35  40  45  50  55  60  65  70  75  80  85  90  95 100
## [20] 105 110 115 120 125 130 135 140 145 150
```

```r
sample_size &lt;- setNames(sample_size, 
                        english::english(seq(10, 150, 5))) 
sample_size[1:15]
```

```
##          ten      fifteen       twenty  twenty-five       thirty  thirty-five 
##           10           15           20           25           30           35 
##        forty   forty-five        fifty   fifty-five        sixty   sixty-five 
##           40           45           50           55           60           65 
##      seventy seventy-five       eighty 
##           70           75           80
```

---
# Try again


```r
sims_df3 &lt;- map_df(sample_size, simulate, 100, 10, 
                   .id = "n")
sims_df3[1:14, ]
```

```
## # A tibble: 14 x 3
##    n       sample_id    sample
##    &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;
##  1 ten             1  90.03031
##  2 ten             2  83.98294
##  3 ten             3 107.7048 
##  4 ten             4 108.7436 
##  5 ten             5 110.1905 
##  6 ten             6  94.22401
##  7 ten             7  95.45904
##  8 ten             8 128.5485 
##  9 ten             9  90.28809
## 10 ten            10 118.2969 
## 11 fifteen         1 109.5122 
## 12 fifteen         2  94.76336
## 13 fifteen         3  93.23244
## 14 fifteen         4 117.3455
```

---
# Another quick example
### `broom::tidy`

* The {broom} package helps us extract model output in a tidy format


```r
lm(tvhours ~ age, gss_cat) %&gt;%
	broom::tidy()
```

```
## # A tibble: 2 x 5
##   term          estimate   std.error statistic       p.value
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 (Intercept) 1.992391   0.06980966   28.54033 4.672161e-173
## 2 age         0.02095679 0.001387361  15.10551 4.689310e- 51
```

---
# Fit separate models by year
### Again - probs not best statistically


```r
 split(gss_cat, gss_cat$year) %&gt;%
 	map_df(~lm(tvhours ~ age, .x) %&gt;%
 	         broom::tidy()) 
```

```
## # A tibble: 16 x 5
##    term          estimate   std.error statistic      p.value
##    &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 (Intercept) 2.080163   0.1709061   12.17138  7.995632e-33
##  2 age         0.01948584 0.003485199  5.591027 2.599011e- 8
##  3 (Intercept) 2.078999   0.2176829    9.550583 1.191266e-20
##  4 age         0.01963575 0.004400292  4.462375 9.137366e- 6
##  5 (Intercept) 1.767990   0.2464509    7.173804 1.531756e-12
##  6 age         0.02386070 0.005031548  4.742218 2.459650e- 6
##  7 (Intercept) 2.096054   0.1496431   14.00702  1.419772e-42
##  8 age         0.01781388 0.002977289  5.983256 2.589482e- 9
##  9 (Intercept) 1.855278   0.2156381    8.603668 2.167351e-17
## 10 age         0.02390720 0.004314567  5.541043 3.628675e- 8
## 11 (Intercept) 2.068914   0.2096397    9.868903 2.896085e-22
## 12 age         0.01989505 0.004086638  4.868317 1.251234e- 6
## 13 (Intercept) 1.878070   0.2258400    8.315932 2.280108e-16
## 14 age         0.02547794 0.004449295  5.726287 1.274840e- 8
## 15 (Intercept) 1.980095   0.1877544   10.54620  3.238043e-25
## 16 age         0.02049066 0.003611900  5.673098 1.650822e- 8
```

---
# .id
In cases like the preceding, `.id` becomes invaluable


```r
split(gss_cat, gss_cat$year) %&gt;%
 	map_df(~lm(tvhours ~ age, .x) %&gt;%
 	         broom::tidy(),
 	       .id = "year") 
```

```
## # A tibble: 16 x 6
##    year  term          estimate   std.error statistic      p.value
##    &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
##  1 2000  (Intercept) 2.080163   0.1709061   12.17138  7.995632e-33
##  2 2000  age         0.01948584 0.003485199  5.591027 2.599011e- 8
##  3 2002  (Intercept) 2.078999   0.2176829    9.550583 1.191266e-20
##  4 2002  age         0.01963575 0.004400292  4.462375 9.137366e- 6
##  5 2004  (Intercept) 1.767990   0.2464509    7.173804 1.531756e-12
##  6 2004  age         0.02386070 0.005031548  4.742218 2.459650e- 6
##  7 2006  (Intercept) 2.096054   0.1496431   14.00702  1.419772e-42
##  8 2006  age         0.01781388 0.002977289  5.983256 2.589482e- 9
##  9 2008  (Intercept) 1.855278   0.2156381    8.603668 2.167351e-17
## 10 2008  age         0.02390720 0.004314567  5.541043 3.628675e- 8
## 11 2010  (Intercept) 2.068914   0.2096397    9.868903 2.896085e-22
## 12 2010  age         0.01989505 0.004086638  4.868317 1.251234e- 6
## 13 2012  (Intercept) 1.878070   0.2258400    8.315932 2.280108e-16
## 14 2012  age         0.02547794 0.004449295  5.726287 1.274840e- 8
## 15 2014  (Intercept) 1.980095   0.1877544   10.54620  3.238043e-25
## 16 2014  age         0.02049066 0.003611900  5.673098 1.650822e- 8
```

---
class: inverse center middle
# Batch-loading data
### Please follow along

&lt;img src="img/pfiles_sim.png" width="400px" /&gt;

---
# {fs}

* note - there are base equivalents. `{fs}` is just a a bit better across
platforms and has better defaults. 


```r
# install.packages("fs")
library(fs)
dir_ls("../data")
```

```
## ../data/data-description.html      ../data/data-description.md        
## ../data/data-sim.R                 ../data/g11ELApfiles18_sim.csv     
## ../data/g11Mathpfiles18_sim.csv    ../data/g11Rdgpfiles18_sim.csv     
## ../data/g11Sciencepfiles18_sim.csv ../data/g11Wripfiles18_sim.csv     
## ../data/g3ELApfiles18_sim.csv      ../data/g3Mathpfiles18_sim.csv     
## ../data/g3Rdgpfiles18_sim.csv      ../data/g3Wripfiles18_sim.csv      
## ../data/g4ELApfiles18_sim.csv      ../data/g4Mathpfiles18_sim.csv     
## ../data/g4Rdgpfiles18_sim.csv      ../data/g4Wripfiles18_sim.csv      
## ../data/g5ELApfiles18_sim.csv      ../data/g5Mathpfiles18_sim.csv     
## ../data/g5Rdgpfiles18_sim.csv      ../data/g5Sciencepfiles18_sim.csv  
## ../data/g5Wripfiles18_sim.csv      ../data/g6ELApfiles18_sim.csv      
## ../data/g6Mathpfiles18_sim.csv     ../data/g6Rdgpfiles18_sim.csv      
## ../data/g6Wripfiles18_sim.csv      ../data/g7ELApfiles18_sim.csv      
## ../data/g7Mathpfiles18_sim.csv     ../data/g7Rdgpfiles18_sim.csv      
## ../data/g7Wripfiles18_sim.csv      ../data/g8ELApfiles18_sim.csv      
## ../data/g8Mathpfiles18_sim.csv     ../data/g8Rdgpfiles18_sim.csv      
## ../data/g8Sciencepfiles18_sim.csv  ../data/g8Wripfiles18_sim.csv      
## ../data/pfiles18
```

### Could we apply `map_df` here?

---
# Limit files
* We really only want the `.csv`


```r
dir_ls("../data", glob = "*.csv")
```

```
## ../data/g11ELApfiles18_sim.csv     ../data/g11Mathpfiles18_sim.csv    
## ../data/g11Rdgpfiles18_sim.csv     ../data/g11Sciencepfiles18_sim.csv 
## ../data/g11Wripfiles18_sim.csv     ../data/g3ELApfiles18_sim.csv      
## ../data/g3Mathpfiles18_sim.csv     ../data/g3Rdgpfiles18_sim.csv      
## ../data/g3Wripfiles18_sim.csv      ../data/g4ELApfiles18_sim.csv      
## ../data/g4Mathpfiles18_sim.csv     ../data/g4Rdgpfiles18_sim.csv      
## ../data/g4Wripfiles18_sim.csv      ../data/g5ELApfiles18_sim.csv      
## ../data/g5Mathpfiles18_sim.csv     ../data/g5Rdgpfiles18_sim.csv      
## ../data/g5Sciencepfiles18_sim.csv  ../data/g5Wripfiles18_sim.csv      
## ../data/g6ELApfiles18_sim.csv      ../data/g6Mathpfiles18_sim.csv     
## ../data/g6Rdgpfiles18_sim.csv      ../data/g6Wripfiles18_sim.csv      
## ../data/g7ELApfiles18_sim.csv      ../data/g7Mathpfiles18_sim.csv     
## ../data/g7Rdgpfiles18_sim.csv      ../data/g7Wripfiles18_sim.csv      
## ../data/g8ELApfiles18_sim.csv      ../data/g8Mathpfiles18_sim.csv     
## ../data/g8Rdgpfiles18_sim.csv      ../data/g8Sciencepfiles18_sim.csv  
## ../data/g8Wripfiles18_sim.csv
```

---
# If we want to be extra careful
* Combine with `here::here`. This will be pretty bullet-proof from a
reproducibility perspective.


```r
dir_ls(here::here("data"), glob = "*.csv")
```

```
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Sciencepfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Wripfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Wripfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Wripfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Wripfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Wripfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Wripfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Sciencepfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Wripfiles18_sim.csv
```

---
# Batch load
* Loop through the directories and `import` or `read_csv`


```r
files &lt;- dir_ls(here::here("data"), glob = "*.csv")
batch &lt;- map_df(files, read_csv)
batch
```

```
## # A tibble: 15,945 x 22
##    Entry   Theta Status Count RawScore     SE Infit Infit_Z  Outfit Outfit_Z
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1   123  1.2687      1    36       23 0.3713  0.93   -0.34 0.82       -0.62
##  2    88  1.5541      1    36       25 0.3852  0.95   -0.37 0.81       -0.56
##  3   105  3.2773      1    36       33 0.6187  0.9    -0.04 1.63000     1.03
##  4   153  4.4752      1    36       35 1.0234  0.93    0.23 0.35       -0.16
##  5   437  2.6655      1    36       31 0.5008  0.92   -0.18 0.88       -0.12
##  6   307  5.7137      0    36       36 1.8371  1       0    1           0   
##  7   305  3.7326      1    36       34 0.7408  1.06    0.31 0.86        0.17
##  8    42  0.609       1    36       18 0.36    1.55    2.56 1.74        3.31
##  9    59 -2.623       1    36        3 1.0344  0.85    0.06 0.17       -0.37
## 10   304  5.7137      0    36       36 1.8371  1       0    1           0   
## # â€¦ with 15,935 more rows, and 12 more variables: Displacement &lt;dbl&gt;,
## #   PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;, ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;,
## #   PointMeasureExpected &lt;dbl&gt;, RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;,
## #   ssid &lt;dbl&gt;, asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---
# Problem
* We've lost a lot of info - no way to identify which file is which

### Try to fix it!

---
# Add id


```r
batch2 &lt;- map_df(files, read_csv, .id = "file")
batch2
```

```
## # A tibble: 15,945 x 23
##    file  Entry   Theta Status Count RawScore     SE Infit Infit_Z  Outfit
##    &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 /Useâ€¦   123  1.2687      1    36       23 0.3713  0.93   -0.34 0.82   
##  2 /Useâ€¦    88  1.5541      1    36       25 0.3852  0.95   -0.37 0.81   
##  3 /Useâ€¦   105  3.2773      1    36       33 0.6187  0.9    -0.04 1.63000
##  4 /Useâ€¦   153  4.4752      1    36       35 1.0234  0.93    0.23 0.35   
##  5 /Useâ€¦   437  2.6655      1    36       31 0.5008  0.92   -0.18 0.88   
##  6 /Useâ€¦   307  5.7137      0    36       36 1.8371  1       0    1      
##  7 /Useâ€¦   305  3.7326      1    36       34 0.7408  1.06    0.31 0.86   
##  8 /Useâ€¦    42  0.609       1    36       18 0.36    1.55    2.56 1.74   
##  9 /Useâ€¦    59 -2.623       1    36        3 1.0344  0.85    0.06 0.17   
## 10 /Useâ€¦   304  5.7137      0    36       36 1.8371  1       0    1      
## # â€¦ with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---


```r
batch2 %&gt;%
	count(file)
```

```
## # A tibble: 31 x 2
##    file                                                                        n
##    &lt;chr&gt;                                                                   &lt;int&gt;
##  1 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   453
##  2 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   460
##  3 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   453
##  4 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   438
##  5 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   453
##  6 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   540
##  7 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   536
##  8 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   540
##  9 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   540
## 10 /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_â€¦   585
## # â€¦ with 21 more rows
```

* Still not terrifically useful. What can we do?

---
# Step 1

* Remove the `here::here` path from string


```r
batch2 &lt;- batch2 %&gt;%
	mutate(file = str_replace_all(file, here::here("data"), ""))

count(batch2, file)
```

```
## # A tibble: 31 x 2
##    file                            n
##    &lt;chr&gt;                       &lt;int&gt;
##  1 /g11ELApfiles18_sim.csv       453
##  2 /g11Mathpfiles18_sim.csv      460
##  3 /g11Rdgpfiles18_sim.csv       453
##  4 /g11Sciencepfiles18_sim.csv   438
##  5 /g11Wripfiles18_sim.csv       453
##  6 /g3ELApfiles18_sim.csv        540
##  7 /g3Mathpfiles18_sim.csv       536
##  8 /g3Rdgpfiles18_sim.csv        540
##  9 /g3Wripfiles18_sim.csv        540
## 10 /g4ELApfiles18_sim.csv        585
## # â€¦ with 21 more rows
```

---
# Pull out pieces you need

* Regular expressions are most powerful here

	+ We haven't talked about them much

* Try [RegExplain](https://www.garrickadenbuie.com/project/regexplain/)

---
# Pull grade

* Note - I'm not expecting you to just suddenly be able to do this. This is more
for illustration. There's also other ways you could extract the same info


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1")) %&gt;%
	select(file, grade)
```

```
## # A tibble: 15,945 x 2
##    file                    grade
##    &lt;chr&gt;                   &lt;chr&gt;
##  1 /g11ELApfiles18_sim.csv 11   
##  2 /g11ELApfiles18_sim.csv 11   
##  3 /g11ELApfiles18_sim.csv 11   
##  4 /g11ELApfiles18_sim.csv 11   
##  5 /g11ELApfiles18_sim.csv 11   
##  6 /g11ELApfiles18_sim.csv 11   
##  7 /g11ELApfiles18_sim.csv 11   
##  8 /g11ELApfiles18_sim.csv 11   
##  9 /g11ELApfiles18_sim.csv 11   
## 10 /g11ELApfiles18_sim.csv 11   
## # â€¦ with 15,935 more rows
```

---
# `parse_number`

* In this case `parse_number` also works - but note that it would not work to
extract the year


```r
batch2 %&gt;%
*mutate(grade = parse_number(file)) %&gt;%
	select(file, grade)
```

```
## # A tibble: 15,945 x 2
##    file                    grade
##    &lt;chr&gt;                   &lt;dbl&gt;
##  1 /g11ELApfiles18_sim.csv    11
##  2 /g11ELApfiles18_sim.csv    11
##  3 /g11ELApfiles18_sim.csv    11
##  4 /g11ELApfiles18_sim.csv    11
##  5 /g11ELApfiles18_sim.csv    11
##  6 /g11ELApfiles18_sim.csv    11
##  7 /g11ELApfiles18_sim.csv    11
##  8 /g11ELApfiles18_sim.csv    11
##  9 /g11ELApfiles18_sim.csv    11
## 10 /g11ELApfiles18_sim.csv    11
## # â€¦ with 15,935 more rows
```

---
# Extract year

* In this case `parse_number` also works - but note that it would not work to
extract the year


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1"),
*       year = str_replace_all(file, ".+files(\\d\\d)_sim.+", "\\1")) %&gt;%
	select(file, grade, year)
```

```
## # A tibble: 15,945 x 3
##    file                    grade year 
##    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;
##  1 /g11ELApfiles18_sim.csv 11    18   
##  2 /g11ELApfiles18_sim.csv 11    18   
##  3 /g11ELApfiles18_sim.csv 11    18   
##  4 /g11ELApfiles18_sim.csv 11    18   
##  5 /g11ELApfiles18_sim.csv 11    18   
##  6 /g11ELApfiles18_sim.csv 11    18   
##  7 /g11ELApfiles18_sim.csv 11    18   
##  8 /g11ELApfiles18_sim.csv 11    18   
##  9 /g11ELApfiles18_sim.csv 11    18   
## 10 /g11ELApfiles18_sim.csv 11    18   
## # â€¦ with 15,935 more rows
```

---
# Extract Content Area


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1"),
	       year = str_replace_all(file, ".+files(\\d\\d)_sim.+", "\\1"),
*       content = str_replace_all(file, "/g\\d?\\d(.+)pfiles.+", "\\1")) %&gt;%
	select(file, grade, year, content)
```

```
## # A tibble: 15,945 x 4
##    file                    grade year  content
##    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
##  1 /g11ELApfiles18_sim.csv 11    18    ELA    
##  2 /g11ELApfiles18_sim.csv 11    18    ELA    
##  3 /g11ELApfiles18_sim.csv 11    18    ELA    
##  4 /g11ELApfiles18_sim.csv 11    18    ELA    
##  5 /g11ELApfiles18_sim.csv 11    18    ELA    
##  6 /g11ELApfiles18_sim.csv 11    18    ELA    
##  7 /g11ELApfiles18_sim.csv 11    18    ELA    
##  8 /g11ELApfiles18_sim.csv 11    18    ELA    
##  9 /g11ELApfiles18_sim.csv 11    18    ELA    
## 10 /g11ELApfiles18_sim.csv 11    18    ELA    
## # â€¦ with 15,935 more rows
```

---
# Double checks: grade


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, 
	                               "/g(\\d?\\d).+", 
	                               "\\1"),
	       year = str_replace_all(file, 
	                              ".+files(\\d\\d)_sim.+", 
	                              "\\1"),
	       content = str_replace_all(file, 
	                                 "/g\\d?\\d(.+)pfiles.+", 
	                                 "\\1")) %&gt;%
	select(file, grade, year, content) %&gt;%
	count(grade)
```

```
## # A tibble: 7 x 2
##   grade     n
##   &lt;chr&gt; &lt;int&gt;
## 1 11     2257
## 2 3      2156
## 3 4      2341
## 4 5      2632
## 5 6      2216
## 6 7      1962
## 7 8      2381
```

---
# Double checks: year


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, 
	                               "/g(\\d?\\d).+", 
	                               "\\1"),
	       year = str_replace_all(file, 
	                              ".+files(\\d\\d)_sim.+", 
	                              "\\1"),
	       content = str_replace_all(file, 
	                                 "/g\\d?\\d(.+)pfiles.+", 
	                                 "\\1")) %&gt;%
	select(file, grade, year, content) %&gt;%
	count(year)
```

```
## # A tibble: 1 x 2
##   year      n
##   &lt;chr&gt; &lt;int&gt;
## 1 18    15945
```

---
# Double checks: content


```r
batch2 %&gt;%
	mutate(grade = str_replace_all(file, 
	                               "/g(\\d?\\d).+", 
	                               "\\1"),
	       year = str_replace_all(file, 
	                              ".+files(\\d\\d)_sim.+", 
	                              "\\1"),
	       content = str_replace_all(file, 
	                                 "/g\\d?\\d(.+)pfiles.+", 
	                                 "\\1")) %&gt;%
	select(file, grade, year, content) %&gt;%
	count(content)
```

```
## # A tibble: 5 x 2
##   content     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 ELA      3627
## 2 Math     3629
## 3 Rdg      3627
## 4 Science  1435
## 5 Wri      3627
```

---
# Finalize


```r
d &lt;- batch2 %&gt;%
	mutate(grade = str_replace_all(file, "/g(\\d?\\d).+", "\\1"),
	       grade = as.integer(grade),
	       year = str_replace_all(file, ".+files(\\d\\d)_sim.+", "\\1"),
	       year = as.integer(grade),
	       content = str_replace_all(file, "/g\\d?\\d(.+)pfiles.+", "\\1")) %&gt;%
	select(-file) %&gt;%
	select(ssid, grade, year, content, testeventid, asmtprmrydsbltycd,
	       asmtscndrydsbltycd, Entry:WMLE)
```

---
# Final product
* In this case, we basically have a tidy data frame already! 

* We've reduced our problem from 31 files to a single file


```r
d
```

```
## # A tibble: 15,945 x 25
##        ssid grade  year content testeventid asmtprmrydsbltycd asmtscndrydsbltycd
##       &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;         &lt;dbl&gt;             &lt;dbl&gt;              &lt;dbl&gt;
##  1  9466908    11    11 ELA          148933                 0                  0
##  2  7683685    11    11 ELA          147875                10                  0
##  3  9025693    11    11 ELA          143699                40                 20
##  4 10099824    11    11 ELA          143962                82                  0
##  5 18886078    11    11 ELA          150680                10                  0
##  6 10606750    11    11 ELA          144583                80                 80
##  7 10541306    11    11 ELA          145204                50                  0
##  8  7632967    11    11 ELA          148926                10                  0
##  9  7661118    11    11 ELA          148893                50                  0
## 10 10547177    11    11 ELA          144583                82                  0
## # â€¦ with 15,935 more rows, and 18 more variables: Entry &lt;dbl&gt;, Theta &lt;dbl&gt;,
## #   Status &lt;dbl&gt;, Count &lt;dbl&gt;, RawScore &lt;dbl&gt;, SE &lt;dbl&gt;, Infit &lt;dbl&gt;,
## #   Infit_Z &lt;dbl&gt;, Outfit &lt;dbl&gt;, Outfit_Z &lt;dbl&gt;, Displacement &lt;dbl&gt;,
## #   PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;, ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;,
## #   PointMeasureExpected &lt;dbl&gt;, RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;
```

---
# Quick look at distributions
![](w4p1_files/figure-html/fig-1.png)&lt;!-- --&gt;


---
# Calculate some summary stats


```r
d %&gt;%
	group_by(grade, content, asmtprmrydsbltycd) %&gt;%
	summarize(mean = mean(Theta)) %&gt;%
	pivot_wider(names_from = content, 
	            values_from = mean)
```

```
## # A tibble: 77 x 7
## # Groups:   grade [7]
##    grade asmtprmrydsbltycd         ELA        Math        Rdg        Wri Science
##    &lt;int&gt;             &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1     3                 0 -0.073610   -1.21055     1.010455   1.612308       NA
##  2     3                10  0.3700416  -0.8182091   0.5184354  0.3206475      NA
##  3     3                20 -0.06335000 -1.251400    1.52      -0.5775         NA
##  4     3                40 -1.877683   -3.56365    -1.761667  -0.7514286      NA
##  5     3                50  0.9462857  -0.09186957  0.9791176  1.191481       NA
##  6     3                60  0.8407750   1.040375    2.181111   1.067          NA
##  7     3                70 -1.104049   -1.517955   -0.8454839 -1.005625       NA
##  8     3                74  0.996       0.02083750  0.6        1.2925         NA
##  9     3                80 -0.144304   -0.5325596   0.6791667  0.2686301      NA
## 10     3                82  0.3708244  -1.080988    0.5676650  0.3440741      NA
## # â€¦ with 67 more rows
```

---
# Backing up a bit

* What if we wanted only math files?


```r
dir_ls(here::here("data"), regexp = "Math")
```

```
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Mathpfiles18_sim.csv
```

---
# Only Grade 5
### You try

--

```r
dir_ls(here::here("data"), regexp = "g5")
```

```
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5ELApfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Mathpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv
## /Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Wripfiles18_sim.csv
```

---
# Base equivalents


```r
list.files(here::here("data"))
```

```
##  [1] "data-description.html"      "data-description.md"       
##  [3] "data-sim.R"                 "g11ELApfiles18_sim.csv"    
##  [5] "g11Mathpfiles18_sim.csv"    "g11Rdgpfiles18_sim.csv"    
##  [7] "g11Sciencepfiles18_sim.csv" "g11Wripfiles18_sim.csv"    
##  [9] "g3ELApfiles18_sim.csv"      "g3Mathpfiles18_sim.csv"    
## [11] "g3Rdgpfiles18_sim.csv"      "g3Wripfiles18_sim.csv"     
## [13] "g4ELApfiles18_sim.csv"      "g4Mathpfiles18_sim.csv"    
## [15] "g4Rdgpfiles18_sim.csv"      "g4Wripfiles18_sim.csv"     
## [17] "g5ELApfiles18_sim.csv"      "g5Mathpfiles18_sim.csv"    
## [19] "g5Rdgpfiles18_sim.csv"      "g5Sciencepfiles18_sim.csv" 
## [21] "g5Wripfiles18_sim.csv"      "g6ELApfiles18_sim.csv"     
## [23] "g6Mathpfiles18_sim.csv"     "g6Rdgpfiles18_sim.csv"     
## [25] "g6Wripfiles18_sim.csv"      "g7ELApfiles18_sim.csv"     
## [27] "g7Mathpfiles18_sim.csv"     "g7Rdgpfiles18_sim.csv"     
## [29] "g7Wripfiles18_sim.csv"      "g8ELApfiles18_sim.csv"     
## [31] "g8Mathpfiles18_sim.csv"     "g8Rdgpfiles18_sim.csv"     
## [33] "g8Sciencepfiles18_sim.csv"  "g8Wripfiles18_sim.csv"     
## [35] "pfiles18"
```

---
# Full path


```r
list.files(here::here("data"), full.names = TRUE)
```

```
##  [1] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/data-description.html"     
##  [2] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/data-description.md"       
##  [3] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/data-sim.R"                
##  [4] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11ELApfiles18_sim.csv"    
##  [5] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Mathpfiles18_sim.csv"   
##  [6] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Rdgpfiles18_sim.csv"    
##  [7] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Sciencepfiles18_sim.csv"
##  [8] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Wripfiles18_sim.csv"    
##  [9] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3ELApfiles18_sim.csv"     
## [10] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Mathpfiles18_sim.csv"    
## [11] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Rdgpfiles18_sim.csv"     
## [12] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Wripfiles18_sim.csv"     
## [13] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4ELApfiles18_sim.csv"     
## [14] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Mathpfiles18_sim.csv"    
## [15] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Rdgpfiles18_sim.csv"     
## [16] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Wripfiles18_sim.csv"     
## [17] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5ELApfiles18_sim.csv"     
## [18] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Mathpfiles18_sim.csv"    
## [19] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv"     
## [20] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv" 
## [21] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Wripfiles18_sim.csv"     
## [22] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6ELApfiles18_sim.csv"     
## [23] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Mathpfiles18_sim.csv"    
## [24] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Rdgpfiles18_sim.csv"     
## [25] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Wripfiles18_sim.csv"     
## [26] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7ELApfiles18_sim.csv"     
## [27] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Mathpfiles18_sim.csv"    
## [28] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Rdgpfiles18_sim.csv"     
## [29] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Wripfiles18_sim.csv"     
## [30] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8ELApfiles18_sim.csv"     
## [31] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Mathpfiles18_sim.csv"    
## [32] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Rdgpfiles18_sim.csv"     
## [33] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Sciencepfiles18_sim.csv" 
## [34] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Wripfiles18_sim.csv"     
## [35] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/pfiles18"
```

---
# Only csvs


```r
list.files(here::here("data"), 
           full.names = TRUE,
           pattern = "*.csv")
```

```
##  [1] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11ELApfiles18_sim.csv"    
##  [2] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Mathpfiles18_sim.csv"   
##  [3] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Rdgpfiles18_sim.csv"    
##  [4] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Sciencepfiles18_sim.csv"
##  [5] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g11Wripfiles18_sim.csv"    
##  [6] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3ELApfiles18_sim.csv"     
##  [7] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Mathpfiles18_sim.csv"    
##  [8] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Rdgpfiles18_sim.csv"     
##  [9] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g3Wripfiles18_sim.csv"     
## [10] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4ELApfiles18_sim.csv"     
## [11] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Mathpfiles18_sim.csv"    
## [12] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Rdgpfiles18_sim.csv"     
## [13] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g4Wripfiles18_sim.csv"     
## [14] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5ELApfiles18_sim.csv"     
## [15] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Mathpfiles18_sim.csv"    
## [16] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Rdgpfiles18_sim.csv"     
## [17] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Sciencepfiles18_sim.csv" 
## [18] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g5Wripfiles18_sim.csv"     
## [19] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6ELApfiles18_sim.csv"     
## [20] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Mathpfiles18_sim.csv"    
## [21] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Rdgpfiles18_sim.csv"     
## [22] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g6Wripfiles18_sim.csv"     
## [23] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7ELApfiles18_sim.csv"     
## [24] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Mathpfiles18_sim.csv"    
## [25] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Rdgpfiles18_sim.csv"     
## [26] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g7Wripfiles18_sim.csv"     
## [27] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8ELApfiles18_sim.csv"     
## [28] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Mathpfiles18_sim.csv"    
## [29] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Rdgpfiles18_sim.csv"     
## [30] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Sciencepfiles18_sim.csv" 
## [31] "/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/data/g8Wripfiles18_sim.csv"
```

---
# Why not use base?
* We could, but `{fs}` plays a little nicer with `{purrr}`

--

```r
files &lt;- list.files(here::here("data"), pattern = "*.csv")
batch3 &lt;- map_df(files, read_csv, .id = "file")
```

```
## Error: 'g11ELApfiles18_sim.csv' does not exist in current working directory ('/Users/daniel/Teaching/data_sci_specialization/2019-20/c3-fun_program_r/slides').
```

--
* Need to return full names


```r
files
```

```
##  [1] "g11ELApfiles18_sim.csv"     "g11Mathpfiles18_sim.csv"   
##  [3] "g11Rdgpfiles18_sim.csv"     "g11Sciencepfiles18_sim.csv"
##  [5] "g11Wripfiles18_sim.csv"     "g3ELApfiles18_sim.csv"     
##  [7] "g3Mathpfiles18_sim.csv"     "g3Rdgpfiles18_sim.csv"     
##  [9] "g3Wripfiles18_sim.csv"      "g4ELApfiles18_sim.csv"     
## [11] "g4Mathpfiles18_sim.csv"     "g4Rdgpfiles18_sim.csv"     
## [13] "g4Wripfiles18_sim.csv"      "g5ELApfiles18_sim.csv"     
## [15] "g5Mathpfiles18_sim.csv"     "g5Rdgpfiles18_sim.csv"     
## [17] "g5Sciencepfiles18_sim.csv"  "g5Wripfiles18_sim.csv"     
## [19] "g6ELApfiles18_sim.csv"      "g6Mathpfiles18_sim.csv"    
## [21] "g6Rdgpfiles18_sim.csv"      "g6Wripfiles18_sim.csv"     
## [23] "g7ELApfiles18_sim.csv"      "g7Mathpfiles18_sim.csv"    
## [25] "g7Rdgpfiles18_sim.csv"      "g7Wripfiles18_sim.csv"     
## [27] "g8ELApfiles18_sim.csv"      "g8Mathpfiles18_sim.csv"    
## [29] "g8Rdgpfiles18_sim.csv"      "g8Sciencepfiles18_sim.csv" 
## [31] "g8Wripfiles18_sim.csv"
```

---
# Try again


```r
files &lt;- list.files(here::here("data"), 
                    pattern = "*.csv", 
                    full.names = TRUE)
batch3 &lt;- map_df(files, read_csv, .id = "file")
batch3
```

```
## # A tibble: 15,945 x 23
##    file  Entry   Theta Status Count RawScore     SE Infit Infit_Z  Outfit
##    &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 1       123  1.2687      1    36       23 0.3713  0.93   -0.34 0.82   
##  2 1        88  1.5541      1    36       25 0.3852  0.95   -0.37 0.81   
##  3 1       105  3.2773      1    36       33 0.6187  0.9    -0.04 1.63000
##  4 1       153  4.4752      1    36       35 1.0234  0.93    0.23 0.35   
##  5 1       437  2.6655      1    36       31 0.5008  0.92   -0.18 0.88   
##  6 1       307  5.7137      0    36       36 1.8371  1       0    1      
##  7 1       305  3.7326      1    36       34 0.7408  1.06    0.31 0.86   
##  8 1        42  0.609       1    36       18 0.36    1.55    2.56 1.74   
##  9 1        59 -2.623       1    36        3 1.0344  0.85    0.06 0.17   
## 10 1       304  5.7137      0    36       36 1.8371  1       0    1      
## # â€¦ with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---
# indexes
* The prior example gave us indexes, rather than the file path. Why?


--
### No names

```r
names(files)
```

```
## NULL
```

* We .bolder[need] the file path! An index isn't nearly as useful.

---
# Base method that works


```r
files &lt;- list.files(here::here("data"), 
                    pattern = "*.csv", 
                    full.names = TRUE) 
files &lt;- setNames(files, files)

batch4 &lt;- map_df(files, read_csv, .id = "file")
batch4
```

```
## # A tibble: 15,945 x 23
##    file  Entry   Theta Status Count RawScore     SE Infit Infit_Z  Outfit
##    &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 /Useâ€¦   123  1.2687      1    36       23 0.3713  0.93   -0.34 0.82   
##  2 /Useâ€¦    88  1.5541      1    36       25 0.3852  0.95   -0.37 0.81   
##  3 /Useâ€¦   105  3.2773      1    36       33 0.6187  0.9    -0.04 1.63000
##  4 /Useâ€¦   153  4.4752      1    36       35 1.0234  0.93    0.23 0.35   
##  5 /Useâ€¦   437  2.6655      1    36       31 0.5008  0.92   -0.18 0.88   
##  6 /Useâ€¦   307  5.7137      0    36       36 1.8371  1       0    1      
##  7 /Useâ€¦   305  3.7326      1    36       34 0.7408  1.06    0.31 0.86   
##  8 /Useâ€¦    42  0.609       1    36       18 0.36    1.55    2.56 1.74   
##  9 /Useâ€¦    59 -2.623       1    36        3 1.0344  0.85    0.06 0.17   
## 10 /Useâ€¦   304  5.7137      0    36       36 1.8371  1       0    1      
## # â€¦ with 15,935 more rows, and 13 more variables: Outfit_Z &lt;dbl&gt;,
## #   Displacement &lt;dbl&gt;, PointMeasureCorr &lt;dbl&gt;, Weight &lt;dbl&gt;,
## #   ObservMatch &lt;dbl&gt;, ExpectMatch &lt;dbl&gt;, PointMeasureExpected &lt;dbl&gt;,
## #   RMSR &lt;dbl&gt;, WMLE &lt;dbl&gt;, testeventid &lt;dbl&gt;, ssid &lt;dbl&gt;,
## #   asmtprmrydsbltycd &lt;dbl&gt;, asmtscndrydsbltycd &lt;dbl&gt;
```

---
# My recommendation
* If you're working interactively, no reason not to use `{fs}`

* If you are building functions that take generic paths, might be worth
considering skipping the dependency


--
### Note
I am .bolder[not] saying skip it, but rather that you should .bolder[consider]
whether it is really needed or not.

---
class: inverse center middle

# List columns

---
# Comparing models
Let's say we wanted to fit/compare a set of models for each content area

1. `lm(Theta ~ asmtprmrydsbltycd)`
1. `lm(Theta ~ asmtprmrydsbltycd + asmtscndrydsbltycd)`
1. `lm(Theta ~ asmtprmrydsbltycd + asmtscndrydsbltycd +
	asmtprmrydsbltycd:asmtscndrydsbltycd)`


---
# Split the data

The base method we've been using...


```r
splt_content &lt;- split(d, d$content)
str(splt_content)
```

```
## List of 5
##  $ ELA    : tibble [3,627 Ã— 25] (S3: tbl_df/tbl/data.frame)
##   ..$ ssid                : num [1:3627] 9466908 7683685 9025693 10099824 18886078 ...
##   ..$ grade               : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3627] "ELA" "ELA" "ELA" "ELA" ...
##   ..$ testeventid         : num [1:3627] 148933 147875 143699 143962 150680 ...
##   ..$ asmtprmrydsbltycd   : num [1:3627] 0 10 40 82 10 80 50 10 50 82 ...
##   ..$ asmtscndrydsbltycd  : num [1:3627] 0 0 20 0 0 80 0 0 0 0 ...
##   ..$ Entry               : num [1:3627] 123 88 105 153 437 307 305 42 59 304 ...
##   ..$ Theta               : num [1:3627] 1.27 1.55 3.28 4.48 2.67 ...
##   ..$ Status              : num [1:3627] 1 1 1 1 1 0 1 1 1 0 ...
##   ..$ Count               : num [1:3627] 36 36 36 36 36 36 36 36 36 36 ...
##   ..$ RawScore            : num [1:3627] 23 25 33 35 31 36 34 18 3 36 ...
##   ..$ SE                  : num [1:3627] 0.371 0.385 0.619 1.023 0.501 ...
##   ..$ Infit               : num [1:3627] 0.93 0.95 0.9 0.93 0.92 1 1.06 1.55 0.85 1 ...
##   ..$ Infit_Z             : num [1:3627] -0.34 -0.37 -0.04 0.23 -0.18 0 0.31 2.56 0.06 0 ...
##   ..$ Outfit              : num [1:3627] 0.82 0.81 1.63 0.35 0.88 1 0.86 1.74 0.17 1 ...
##   ..$ Outfit_Z            : num [1:3627] -0.62 -0.56 1.03 -0.16 -0.12 0 0.17 3.31 -0.37 0 ...
##   ..$ Displacement        : num [1:3627] 0.0018 0.0019 0.0022 0.0023 0.0021 0.0024 0.0022 0.0017 0.0009 0.0024 ...
##   ..$ PointMeasureCorr    : num [1:3627] 0.42 0.42 0.3 0.27 0.31 0 0.14 -0.12 0.32 0 ...
##   ..$ Weight              : num [1:3627] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3627] 75 80.6 91.7 97.2 86.1 100 94.4 50 97.2 100 ...
##   ..$ ExpectMatch         : num [1:3627] 68.3 72 91.7 97.2 86.1 100 94.4 65 97.2 100 ...
##   ..$ PointMeasureExpected: num [1:3627] 0.35 0.33 0.2 0.12 0.25 0 0.17 0.38 0.17 0 ...
##   ..$ RMSR                : num [1:3627] 0.42 0.39 0.26 0.16 0.31 0 0.23 0.51 0.14 0 ...
##   ..$ WMLE                : num [1:3627] 1.25 1.68 3.13 4 2.59 ...
##  $ Math   : tibble [3,629 Ã— 25] (S3: tbl_df/tbl/data.frame)
##   ..$ ssid                : num [1:3629] 10129634 10926496 10616063 10139443 8887381 ...
##   ..$ grade               : int [1:3629] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3629] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3629] "Math" "Math" "Math" "Math" ...
##   ..$ testeventid         : num [1:3629] 147564 151249 146976 151229 147676 ...
##   ..$ asmtprmrydsbltycd   : num [1:3629] 10 80 10 10 80 82 10 10 40 82 ...
##   ..$ asmtscndrydsbltycd  : num [1:3629] 0 90 0 0 10 80 50 0 50 0 ...
##   ..$ Entry               : num [1:3629] 161 344 321 167 101 131 141 357 14 367 ...
##   ..$ Theta               : num [1:3629] 0.514 1.965 0.899 1.965 -4.724 ...
##   ..$ Status              : num [1:3629] 1 1 1 1 -1 1 1 1 1 1 ...
##   ..$ Count               : num [1:3629] 36 36 36 36 36 36 36 36 36 36 ...
##   ..$ RawScore            : num [1:3629] 19 29 22 29 0 14 18 25 19 22 ...
##   ..$ SE                  : num [1:3629] 0.356 0.436 0.362 0.436 1.839 ...
##   ..$ Infit               : num [1:3629] 0.97 1.03 0.99 1 1 1.01 0.99 0.85 0.96 1.06 ...
##   ..$ Infit_Z             : num [1:3629] -0.18 0.26 -0.09 0.1 0 0.13 -0.06 -0.81 -0.39 0.5 ...
##   ..$ Outfit              : num [1:3629] 0.97 1.03 1.01 0.87 1 0.93 1 0.77 0.97 0.99 ...
##   ..$ Outfit_Z            : num [1:3629] -0.17 0.23 0.17 -0.46 0 -0.03 0.03 -0.87 -0.19 0.07 ...
##   ..$ Displacement        : num [1:3629] 5e-04 5e-04 5e-04 5e-04 -7e-04 4e-04 5e-04 5e-04 5e-04 5e-04 ...
##   ..$ PointMeasureCorr    : num [1:3629] 0.38 0.28 0.34 0.29 0 0.34 0.38 0.45 0.38 0.27 ...
##   ..$ Weight              : num [1:3629] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3629] 66.7 80.6 66.7 80.6 100 61.1 69.4 75 63.9 61.1 ...
##   ..$ ExpectMatch         : num [1:3629] 64.4 80.5 66 80.5 100 68.3 64.6 70.3 64.4 66 ...
##   ..$ PointMeasureExpected: num [1:3629] 0.35 0.25 0.33 0.25 0 0.35 0.35 0.3 0.35 0.33 ...
##   ..$ RMSR                : num [1:3629] 0.46 0.39 0.45 0.39 0 0.46 0.46 0.4 0.46 0.48 ...
##   ..$ WMLE                : num [1:3629] 0.512 1.915 0.888 1.915 -4.724 ...
##  $ Rdg    : tibble [3,627 Ã— 25] (S3: tbl_df/tbl/data.frame)
##   ..$ ssid                : num [1:3627] 18631185 18342736 10897771 7663935 6709613 ...
##   ..$ grade               : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3627] "Rdg" "Rdg" "Rdg" "Rdg" ...
##   ..$ testeventid         : num [1:3627] 145641 147717 145196 149014 146545 ...
##   ..$ asmtprmrydsbltycd   : num [1:3627] 10 90 10 80 0 10 10 80 82 82 ...
##   ..$ asmtscndrydsbltycd  : num [1:3627] 0 0 0 10 0 82 0 70 0 0 ...
##   ..$ Entry               : num [1:3627] 444 444 343 74 3 77 181 261 297 182 ...
##   ..$ Theta               : num [1:3627] 2.24 3.48 2.72 -2.72 0.12 -1.39 -0.67 4.73 4.73 4.73 ...
##   ..$ Status              : num [1:3627] 1 1 1 1 1 1 1 0 0 0 ...
##   ..$ Count               : num [1:3627] 19 19 19 19 19 19 19 19 19 19 ...
##   ..$ RawScore            : num [1:3627] 16 18 17 1 8 3 5 19 19 19 ...
##   ..$ SE                  : num [1:3627] 0.64 1.03 0.76 1.06 0.49 0.66 0.55 1.84 1.84 1.84 ...
##   ..$ Infit               : num [1:3627] 1.07 1.02 1.1 1 0.98 0.73 1.08 1 1 1 ...
##   ..$ Infit_Z             : num [1:3627] 0.29 0.31 0.53 0.29 -0.11 -0.54 0.37 0 0 0 ...
##   ..$ Outfit              : num [1:3627] 1.17 0.94 1.22 0.76 0.95 0.62 1.09 1 1 1 ...
##   ..$ Outfit_Z            : num [1:3627] 0.45 0.32 0.71 0 -0.22 -0.62 0.42 0 0 0 ...
##   ..$ Displacement        : num [1:3627] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ PointMeasureCorr    : num [1:3627] 0.01 0.08 0.05 0 0.32 0.68 0.2 0 0 0 ...
##   ..$ Weight              : num [1:3627] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3627] 84.2 94.7 89.5 94.7 63.2 84.2 78.9 100 100 100 ...
##   ..$ ExpectMatch         : num [1:3627] 84.2 94.7 89.5 94.7 64.2 85.1 76.3 100 100 100 ...
##   ..$ PointMeasureExpected: num [1:3627] 0.17 0.1 0.14 0.24 0.3 0.31 0.32 0 0 0 ...
##   ..$ RMSR                : num [1:3627] 0.38 0.22 0.31 0.22 0.47 0.34 0.36 0 0 0 ...
##   ..$ WMLE                : num [1:3627] 2.11 3.02 2.5 -2.27 0.14 -0.9 -0.6 4.73 4.73 4.73 ...
##  $ Science: tibble [1,435 Ã— 25] (S3: tbl_df/tbl/data.frame)
##   ..$ ssid                : num [1:1435] 7617607 7642717 10341706 9811494 10469745 ...
##   ..$ grade               : int [1:1435] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:1435] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:1435] "Science" "Science" "Science" "Science" ...
##   ..$ testeventid         : num [1:1435] 148838 144146 149634 146456 144426 ...
##   ..$ asmtprmrydsbltycd   : num [1:1435] 10 82 80 10 90 10 10 80 80 10 ...
##   ..$ asmtscndrydsbltycd  : num [1:1435] 0 80 20 0 50 80 70 0 50 0 ...
##   ..$ Entry               : num [1:1435] 28 43 274 118 291 91 58 130 297 337 ...
##   ..$ Theta               : num [1:1435] 0.875 2.647 4.17 5.404 5.404 ...
##   ..$ Status              : num [1:1435] 1 1 1 0 0 1 1 1 1 1 ...
##   ..$ Count               : num [1:1435] 36 36 36 36 36 36 36 36 36 36 ...
##   ..$ RawScore            : num [1:1435] 22 32 35 36 36 26 2 34 34 28 ...
##   ..$ SE                  : num [1:1435] 0.361 0.544 1.021 1.835 1.835 ...
##   ..$ Infit               : num [1:1435] 1.3 0.94 1.05 1.04 0.99 0.9 0.97 0.99 0.98 0.9 ...
##   ..$ Infit_Z             : num [1:1435] 2.35 0.02 0.37 0.35 0 -0.62 0.17 0.15 0.16 -0.52 ...
##   ..$ Outfit              : num [1:1435] 1.22 0.76 1.5 1.2 0.48 0.85 0.69 1.57 0.67 0.8 ...
##   ..$ Outfit_Z            : num [1:1435] 1.87 -0.27 0.91 0.6 -0.16 -0.87 -0.41 0.74 0.01 -0.76 ...
##   ..$ Displacement        : num [1:1435] 0.0011 0.0016 0.0016 0.0027 0.0027 0.0013 0.0007 0.0016 0.0016 0.0014 ...
##   ..$ PointMeasureCorr    : num [1:1435] 0.07 0.3 -0.07 0 0.29 0.46 0.28 0.05 0.22 0.45 ...
##   ..$ Weight              : num [1:1435] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:1435] 55.6 88.9 97.2 100 100 75 94.4 94.4 94.4 80.6 ...
##   ..$ ExpectMatch         : num [1:1435] 66.1 88.9 97.2 100 100 73.2 94.4 94.4 94.4 77.9 ...
##   ..$ PointMeasureExpected: num [1:1435] 0.32 0.22 0.12 0 0 0.3 0.15 0.16 0.16 0.28 ...
##   ..$ RMSR                : num [1:1435] 0.52 0.3 0.17 0 0 0.39 0.22 0.22 0.22 0.36 ...
##   ..$ WMLE                : num [1:1435] 0.863 2.543 3.692 5.404 5.404 ...
##  $ Wri    : tibble [3,627 Ã— 25] (S3: tbl_df/tbl/data.frame)
##   ..$ ssid                : num [1:3627] 7653093 7640498 7650957 9305807 18060455 ...
##   ..$ grade               : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ year                : int [1:3627] 11 11 11 11 11 11 11 11 11 11 ...
##   ..$ content             : chr [1:3627] "Wri" "Wri" "Wri" "Wri" ...
##   ..$ testeventid         : num [1:3627] 148893 148868 144397 148988 144865 ...
##   ..$ asmtprmrydsbltycd   : num [1:3627] 10 10 90 0 82 10 80 0 10 82 ...
##   ..$ asmtscndrydsbltycd  : num [1:3627] 0 0 80 0 0 0 50 0 0 10 ...
##   ..$ Entry               : num [1:3627] 61 48 63 107 443 214 267 344 423 27 ...
##   ..$ Theta               : num [1:3627] 1.67 2.17 -1.56 5.01 2.17 0.38 0.79 5.01 -0.48 2.78 ...
##   ..$ Status              : num [1:3627] 1 1 1 0 1 1 1 0 1 1 ...
##   ..$ Count               : num [1:3627] 13 13 13 13 13 13 13 13 13 13 ...
##   ..$ RawScore            : num [1:3627] 9 10 2 13 10 6 7 13 4 11 ...
##   ..$ SE                  : num [1:3627] 0.69 0.74 0.83 1.87 0.74 0.64 0.65 1.87 0.68 0.84 ...
##   ..$ Infit               : num [1:3627] 0.52 0.65 0.61 1 1.01 0.46 0.47 1 0.9 0.88 ...
##   ..$ Infit_Z             : num [1:3627] -2.07 -1.02 -0.79 0 0.24 -2.3 -2.2 0 -0.16 -0.21 ...
##   ..$ Outfit              : num [1:3627] 0.44 0.52 0.33 1 0.74 0.41 0.4 1 1.32 0.54 ...
##   ..$ Outfit_Z            : num [1:3627] -1.65 -0.81 -0.47 0 -0.06 -1.88 -1.85 0 -0.14 -0.16 ...
##   ..$ Displacement        : num [1:3627] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ PointMeasureCorr    : num [1:3627] 0.86 0.73 0.62 0 0.51 0.87 0.87 0 0.56 0.56 ...
##   ..$ Weight              : num [1:3627] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ ObservMatch         : num [1:3627] 100 92.3 84.6 100 76.9 100 100 100 92.3 84.6 ...
##   ..$ ExpectMatch         : num [1:3627] 75.5 79.7 84.6 100 79.7 72.9 73 100 74.5 84.6 ...
##   ..$ PointMeasureExpected: num [1:3627] 0.48 0.44 0.34 0 0.44 0.5 0.51 0 0.45 0.38 ...
##   ..$ RMSR                : num [1:3627] 0.31 0.34 0.26 0 0.38 0.29 0.29 0 0.37 0.31 ...
##   ..$ WMLE                : num [1:3627] 1.61 2.08 -1.38 5.01 2.08 0.38 0.78 5.01 -0.43 2.61 ...
```

---
# We could use this method


```r
m1 &lt;- map(splt_content, ~lm(Theta ~ asmtprmrydsbltycd, 
          									data = .x))
m2 &lt;- map(splt_content, ~lm(Theta ~ asmtprmrydsbltycd + 
                               			asmtscndrydsbltycd, 
														data = .x))
m3 &lt;- map(splt_content, ~lm(Theta ~ asmtprmrydsbltycd*asmtscndrydsbltycd, 
          									data = .x))
```

* We could then go through and conduct tests to see which model was better, etc.


---
# Alternative
* Create a data frame with a list column


```r
d %&gt;%
	nest(-content)
```

```
## # A tibble: 5 x 2
##   content data                 
##   &lt;chr&gt;   &lt;list&gt;               
## 1 ELA     &lt;tibble [3,627 Ã— 24]&gt;
## 2 Math    &lt;tibble [3,629 Ã— 24]&gt;
## 3 Rdg     &lt;tibble [3,627 Ã— 24]&gt;
## 4 Science &lt;tibble [1,435 Ã— 24]&gt;
## 5 Wri     &lt;tibble [3,627 Ã— 24]&gt;
```

---
# Add model list column


```r
mods &lt;- d %&gt;%
	nest(-content) %&gt;%
	mutate(m1 = map(data, ~lm(Theta ~ asmtprmrydsbltycd, 
          									data = .x)),
         m2 = map(data, ~lm(Theta ~ asmtprmrydsbltycd + asmtscndrydsbltycd, 
          									data = .x)),
         m3 = map(data, ~lm(Theta ~ asmtprmrydsbltycd*asmtscndrydsbltycd, 
          									data = .x)))
mods
```

```
## # A tibble: 5 x 5
##   content data                  m1     m2     m3    
##   &lt;chr&gt;   &lt;list&gt;                &lt;list&gt; &lt;list&gt; &lt;list&gt;
## 1 ELA     &lt;tibble [3,627 Ã— 24]&gt; &lt;lm&gt;   &lt;lm&gt;   &lt;lm&gt;  
## 2 Math    &lt;tibble [3,629 Ã— 24]&gt; &lt;lm&gt;   &lt;lm&gt;   &lt;lm&gt;  
## 3 Rdg     &lt;tibble [3,627 Ã— 24]&gt; &lt;lm&gt;   &lt;lm&gt;   &lt;lm&gt;  
## 4 Science &lt;tibble [1,435 Ã— 24]&gt; &lt;lm&gt;   &lt;lm&gt;   &lt;lm&gt;  
## 5 Wri     &lt;tibble [3,627 Ã— 24]&gt; &lt;lm&gt;   &lt;lm&gt;   &lt;lm&gt;
```

---
# Part of the benefit
### It's a normal data frame!


```r
mods %&gt;%
	pivot_longer(m1:m3, names_to = "model", values_to = "output")
```

```
## # A tibble: 15 x 4
##    content data                  model output
##    &lt;chr&gt;   &lt;list&gt;                &lt;chr&gt; &lt;list&gt;
##  1 ELA     &lt;tibble [3,627 Ã— 24]&gt; m1    &lt;lm&gt;  
##  2 ELA     &lt;tibble [3,627 Ã— 24]&gt; m2    &lt;lm&gt;  
##  3 ELA     &lt;tibble [3,627 Ã— 24]&gt; m3    &lt;lm&gt;  
##  4 Math    &lt;tibble [3,629 Ã— 24]&gt; m1    &lt;lm&gt;  
##  5 Math    &lt;tibble [3,629 Ã— 24]&gt; m2    &lt;lm&gt;  
##  6 Math    &lt;tibble [3,629 Ã— 24]&gt; m3    &lt;lm&gt;  
##  7 Rdg     &lt;tibble [3,627 Ã— 24]&gt; m1    &lt;lm&gt;  
##  8 Rdg     &lt;tibble [3,627 Ã— 24]&gt; m2    &lt;lm&gt;  
##  9 Rdg     &lt;tibble [3,627 Ã— 24]&gt; m3    &lt;lm&gt;  
## 10 Science &lt;tibble [1,435 Ã— 24]&gt; m1    &lt;lm&gt;  
## 11 Science &lt;tibble [1,435 Ã— 24]&gt; m2    &lt;lm&gt;  
## 12 Science &lt;tibble [1,435 Ã— 24]&gt; m3    &lt;lm&gt;  
## 13 Wri     &lt;tibble [3,627 Ã— 24]&gt; m1    &lt;lm&gt;  
## 14 Wri     &lt;tibble [3,627 Ã— 24]&gt; m2    &lt;lm&gt;  
## 15 Wri     &lt;tibble [3,627 Ã— 24]&gt; m3    &lt;lm&gt;
```

---
# Extract all `\(R^2\)`


```r
mods %&gt;%
	pivot_longer(m1:m3, names_to = "model", values_to = "output") %&gt;% 
	mutate(r2 = map_dbl(output, ~summary(.x)$r.squared))
```

```
## # A tibble: 15 x 5
##    content data                  model output            r2
##    &lt;chr&gt;   &lt;list&gt;                &lt;chr&gt; &lt;list&gt;         &lt;dbl&gt;
##  1 ELA     &lt;tibble [3,627 Ã— 24]&gt; m1    &lt;lm&gt;   0.00002742625
##  2 ELA     &lt;tibble [3,627 Ã— 24]&gt; m2    &lt;lm&gt;   0.002784211  
##  3 ELA     &lt;tibble [3,627 Ã— 24]&gt; m3    &lt;lm&gt;   0.002994548  
##  4 Math    &lt;tibble [3,629 Ã— 24]&gt; m1    &lt;lm&gt;   0.0006718361 
##  5 Math    &lt;tibble [3,629 Ã— 24]&gt; m2    &lt;lm&gt;   0.002575408  
##  6 Math    &lt;tibble [3,629 Ã— 24]&gt; m3    &lt;lm&gt;   0.002586228  
##  7 Rdg     &lt;tibble [3,627 Ã— 24]&gt; m1    &lt;lm&gt;   0.0001925962 
##  8 Rdg     &lt;tibble [3,627 Ã— 24]&gt; m2    &lt;lm&gt;   0.0006773540 
##  9 Rdg     &lt;tibble [3,627 Ã— 24]&gt; m3    &lt;lm&gt;   0.0007050212 
## 10 Science &lt;tibble [1,435 Ã— 24]&gt; m1    &lt;lm&gt;   0.0004085780 
## 11 Science &lt;tibble [1,435 Ã— 24]&gt; m2    &lt;lm&gt;   0.0004520424 
## 12 Science &lt;tibble [1,435 Ã— 24]&gt; m3    &lt;lm&gt;   0.004354060  
## 13 Wri     &lt;tibble [3,627 Ã— 24]&gt; m1    &lt;lm&gt;   0.0004902093 
## 14 Wri     &lt;tibble [3,627 Ã— 24]&gt; m2    &lt;lm&gt;   0.001256362  
## 15 Wri     &lt;tibble [3,627 Ã— 24]&gt; m3    &lt;lm&gt;   0.001391980
```

---
# Plot


```r
mods %&gt;%
	pivot_longer(m1:m3, names_to = "model", values_to = "output") %&gt;% 
	mutate(r2 = map_dbl(output, ~summary(.x)$r.squared)) %&gt;%
ggplot(aes(model, r2)) +
	geom_col(aes(fill = model)) +
	facet_wrap(~content) +
	guides(fill = "none") +
	scale_fill_brewer(palette = "Set2")
```

![](w4p1_files/figure-html/model-plot-1.png)&lt;!-- --&gt;

---
# Summary

* Batch processing is .bolder[really] powerful

* Much of the tools we've learned in the past can be applied once we get the
data in a more workable format

* List columns are also .bolder[really] nice for organization and using our data
frame toolkit


--
### Wednesday
* We'll talk more about list columns


--
### Any time left?
* Let's get started on the midterm
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atelier-dune-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
